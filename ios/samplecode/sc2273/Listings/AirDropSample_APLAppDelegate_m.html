<!DOCTYPE html>
<html lang="en">
<head>
    <title>AirDrop Examples: AirDropSample/APLAppDelegate.m</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Sample Code">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/DTS40013842">
	<meta id="document-version" name="document-version" content="1.0.0">
    <meta id="build" name="build" content="bcf073e0579478458b78c3b3068a2133">
    <meta id="chapterId" name="chapterId" content="DTS40013842-AirDropSample_APLAppDelegate_m">
    <meta id="date" name="date" content="2013-10-17">
    <meta id="description" name="description" content=""AirDropSample" illustrates three scenarios for incorporating AirDrop into an app.">
    <meta id="book-title" name="book-title" content="AirDrop Examples">
    <meta id="book-name" name="book-name" content="DTS_SC2273_AirDropExamples">
    <meta id="book-root" name="book-root" content="../">
    <meta id="book-json" name="book-json" content="../book.json">
    <meta id="devcenter" name="devcenter" content="iOS Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/ios">
    <meta id="reflib" name="reflib" content="iOS Developer Library">
    <meta id="book-assignments" name="book-assignments" content="{Type/Sample Code}, {Topic/Networking & Internet}">
    
    
    <meta id="generator" name="generator" content="Gutenberg 003a3034">
    <meta name='numbat' content='aa879094b666337fdcde744b62fbff30'>
    <meta id="copyright" name="copyright" content="Copyright 2014 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="AirDropSample/APLAppDelegate.m">
    <meta id="resources-uri" name="resources-uri" content="../../../Resources/874">
    <link id="book-index-page" rel="Start" title="AirDrop Examples" type="text/html" href="../index.html">
    <link id="next-page" rel="Next" type="text/html" href="https://developer.apple.com/library/ios/samplecode/sc2273/Listings/AirDropSample_APLAsyncImageActivityItemProvider_h.html">
    <link id="previous-page" rel="Prev" type="text/html" href="AirDropSample_APLAppDelegate_h.html">
    <link rel="stylesheet" type="text/css" href="../../../Resources/874/CSS/screen.css">
    
    <link rel="stylesheet" type="text/css" href="../../../Resources/874/CSS/feedback.css">
</head>    
<body><a name="//apple_ref/doc/uid/DTS40013842-AirDropSample_APLAppDelegate_m" title="AirDropSample/APLAppDelegate.m"></a>
    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode phone">
            <a id="ssi_LibraryTitle" href='../../../navigation/index.html'>iOS Developer Library</a>
            <a id="ssi_AppleDeveloperConnection" href='../../../../../index.html'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search iOS Developer Library</label>
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>AirDrop Examples</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main">
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='https://developer.apple.com/library/ios/samplecode/sc2273/Listings/AirDropSample_APLAsyncImageActivityItemProvider_h.html'>Next</a><a class='previousLink' rel='prev' href='AirDropSample_APLAppDelegate_h.html'>Previous</a>
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="../index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/DTS40013842-AirDropSample_APLAppDelegate_m-DontLinkElementID_4" title="AirDropSample/APLAppDelegate.m"></a>
    <h1 id="pageTitle">AirDropSample/APLAppDelegate.m</h1>
    <div class="codesample clear"><table><tr><td scope="row"><pre>/*<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>     File: APLAppDelegate.m<span></span></pre></td></tr><tr><td scope="row"><pre> Abstract: Application Delegate that handles app start up and the AirDropped received files.<span></span></pre></td></tr><tr><td scope="row"><pre>  Version: 1.0<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> Disclaimer: IMPORTANT:  This Apple software is supplied to you by Apple<span></span></pre></td></tr><tr><td scope="row"><pre> Inc. ("Apple") in consideration of your agreement to the following<span></span></pre></td></tr><tr><td scope="row"><pre> terms, and your use, installation, modification or redistribution of<span></span></pre></td></tr><tr><td scope="row"><pre> this Apple software constitutes acceptance of these terms.  If you do<span></span></pre></td></tr><tr><td scope="row"><pre> not agree with these terms, please do not use, install, modify or<span></span></pre></td></tr><tr><td scope="row"><pre> redistribute this Apple software.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> In consideration of your agreement to abide by the following terms, and<span></span></pre></td></tr><tr><td scope="row"><pre> subject to these terms, Apple grants you a personal, non-exclusive<span></span></pre></td></tr><tr><td scope="row"><pre> license, under Apple's copyrights in this original Apple software (the<span></span></pre></td></tr><tr><td scope="row"><pre> "Apple Software"), to use, reproduce, modify and redistribute the Apple<span></span></pre></td></tr><tr><td scope="row"><pre> Software, with or without modifications, in source and/or binary forms;<span></span></pre></td></tr><tr><td scope="row"><pre> provided that if you redistribute the Apple Software in its entirety and<span></span></pre></td></tr><tr><td scope="row"><pre> without modifications, you must retain this notice and the following<span></span></pre></td></tr><tr><td scope="row"><pre> text and disclaimers in all such redistributions of the Apple Software.<span></span></pre></td></tr><tr><td scope="row"><pre> Neither the name, trademarks, service marks or logos of Apple Inc. may<span></span></pre></td></tr><tr><td scope="row"><pre> be used to endorse or promote products derived from the Apple Software<span></span></pre></td></tr><tr><td scope="row"><pre> without specific prior written permission from Apple.  Except as<span></span></pre></td></tr><tr><td scope="row"><pre> expressly stated in this notice, no other rights or licenses, express or<span></span></pre></td></tr><tr><td scope="row"><pre> implied, are granted by Apple herein, including but not limited to any<span></span></pre></td></tr><tr><td scope="row"><pre> patent rights that may be infringed by your derivative works or by other<span></span></pre></td></tr><tr><td scope="row"><pre> works in which the Apple Software may be incorporated.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> The Apple Software is provided by Apple on an "AS IS" basis.  APPLE<span></span></pre></td></tr><tr><td scope="row"><pre> MAKES NO WARRANTIES, EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION<span></span></pre></td></tr><tr><td scope="row"><pre> THE IMPLIED WARRANTIES OF NON-INFRINGEMENT, MERCHANTABILITY AND FITNESS<span></span></pre></td></tr><tr><td scope="row"><pre> FOR A PARTICULAR PURPOSE, REGARDING THE APPLE SOFTWARE OR ITS USE AND<span></span></pre></td></tr><tr><td scope="row"><pre> OPERATION ALONE OR IN COMBINATION WITH YOUR PRODUCTS.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> IN NO EVENT SHALL APPLE BE LIABLE FOR ANY SPECIAL, INDIRECT, INCIDENTAL<span></span></pre></td></tr><tr><td scope="row"><pre> OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF<span></span></pre></td></tr><tr><td scope="row"><pre> SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS<span></span></pre></td></tr><tr><td scope="row"><pre> INTERRUPTION) ARISING IN ANY WAY OUT OF THE USE, REPRODUCTION,<span></span></pre></td></tr><tr><td scope="row"><pre> MODIFICATION AND/OR DISTRIBUTION OF THE APPLE SOFTWARE, HOWEVER CAUSED<span></span></pre></td></tr><tr><td scope="row"><pre> AND WHETHER UNDER THEORY OF CONTRACT, TORT (INCLUDING NEGLIGENCE),<span></span></pre></td></tr><tr><td scope="row"><pre> STRICT LIABILITY OR OTHERWISE, EVEN IF APPLE HAS BEEN ADVISED OF THE<span></span></pre></td></tr><tr><td scope="row"><pre> POSSIBILITY OF SUCH DAMAGE.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> Copyright (C) 2013 Apple Inc. All Rights Reserved.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> */<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#import "APLAppDelegate.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#import "APLProfileTableViewController.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#import "APLSharingTypesTableViewController.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#import "APLProfile.h"<span></span></pre></td></tr><tr><td scope="row"><pre>#import "APLUtilities.h"<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const kCustomScheme = @"adcs";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const kMainStoryboardName = @"Main";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const kProfileViewControllerIdentifier = @"ProfileViewController";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const kDocumentsInboxFolder = @"Inbox";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>//Custom Notifications used when receiving content<span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const DisplayingSaveWindowNotification = @"DisplayingSaveWindow";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const SavedReceivedProfilesNotification = @"SavedReceivedProfiles";<span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const SavedCustomURLNotification = @"SavedCustomURL";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>NSString * const kSavedReceivedProfilesFileNamesKey = @"SavedFileNames";<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@interface APLAppDelegate()<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@property (strong, nonatomic) UINavigationController *navigationController;<span></span></pre></td></tr><tr><td scope="row"><pre>@property (strong, nonatomic) APLSharingTypesTableViewController *sharingTypesViewController;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@property (strong, nonatomic) NSMutableArray *receivedProfileQueue;<span></span></pre></td></tr><tr><td scope="row"><pre>@property (strong, nonatomic) UINavigationController *receivedProfilesNavigationController;<span></span></pre></td></tr><tr><td scope="row"><pre>@property (strong, nonatomic) NSMutableArray *savedFileNames;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@property (strong, nonatomic) UIWindow *saveReceivedWindow;<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@implementation APLAppDelegate<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    self.navigationController = (UINavigationController *)self.window.rootViewController;<span></span></pre></td></tr><tr><td scope="row"><pre>    self.sharingTypesViewController = self.navigationController.viewControllers[0];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    self.savedFileNames = [NSMutableArray array];<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>    return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)applicationDidBecomeActive:(UIApplication *)application<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    //Check for orphaned files in the inbox<span></span></pre></td></tr><tr><td scope="row"><pre>    [self handleDocumentsInbox];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (url) {<span></span></pre></td></tr><tr><td scope="row"><pre>        if (url.scheme &amp;&amp; [url.scheme isEqualToString:kCustomScheme]) {<span></span></pre></td></tr><tr><td scope="row"><pre>            <span></span></pre></td></tr><tr><td scope="row"><pre>            //Save the received profile and notify observers<span></span></pre></td></tr><tr><td scope="row"><pre>            [APLUtilities saveCustomURL:url];<span></span></pre></td></tr><tr><td scope="row"><pre>            [[NSNotificationCenter defaultCenter] postNotificationName:SavedCustomURLNotification object:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>            <span></span></pre></td></tr><tr><td scope="row"><pre>            //Show custom URL view controller if currently in the sharing types table, otherwise don't, the user could be in the middle of something<span></span></pre></td></tr><tr><td scope="row"><pre>            if ([self.navigationController visibleViewController] == self.sharingTypesViewController &amp;&amp; !self.saveReceivedWindow) {<span></span></pre></td></tr><tr><td scope="row"><pre>                [self.sharingTypesViewController showCustomURLView];<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        else<span></span></pre></td></tr><tr><td scope="row"><pre>        {<span></span></pre></td></tr><tr><td scope="row"><pre>            APLProfile *profile = [APLUtilities securelyUnarchiveProfileWithFile:[url path]];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>            if (profile) {<span></span></pre></td></tr><tr><td scope="row"><pre>                <span></span></pre></td></tr><tr><td scope="row"><pre>                //Enqueue profile incase another one is already being handled<span></span></pre></td></tr><tr><td scope="row"><pre>                [self enqueueProfile:profile];<span></span></pre></td></tr><tr><td scope="row"><pre>            }<span></span></pre></td></tr><tr><td scope="row"><pre>            <span></span></pre></td></tr><tr><td scope="row"><pre>            //Clean up inbox<span></span></pre></td></tr><tr><td scope="row"><pre>            [self removeInboxItem:url];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    return YES;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#pragma mark - Document Inbox Handling<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)handleDocumentsInbox<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    //All incoming files are stored in Documents/Inbox/<span></span></pre></td></tr><tr><td scope="row"><pre>    NSString *inboxPath = [[APLUtilities documentsDirectory] stringByAppendingPathComponent:kDocumentsInboxFolder];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    NSFileManager *fileManager = [[NSFileManager alloc] init];<span></span></pre></td></tr><tr><td scope="row"><pre>    NSArray *inboxFiles = [fileManager contentsOfDirectoryAtPath:inboxPath error:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    for (NSString *path in inboxFiles) {<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Append file name to path and create URL<span></span></pre></td></tr><tr><td scope="row"><pre>        NSURL *url = [NSURL fileURLWithPath:[inboxPath stringByAppendingPathComponent:path]];<span></span></pre></td></tr><tr><td scope="row"><pre>        [self application:[UIApplication sharedApplication] openURL:url sourceApplication:@"" annotation:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)removeInboxItem:(NSURL *)itemURL<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    //Clean up the inbox once the file has been processed<span></span></pre></td></tr><tr><td scope="row"><pre>    NSError *error = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>    [[NSFileManager defaultManager] removeItemAtPath:[itemURL path] error:&amp;error];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    if (error) {<span></span></pre></td></tr><tr><td scope="row"><pre>        NSLog(@"ERROR: Inbox file could not be deleted");<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>#pragma mark - AirDropped Profile Receiving<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>/****************************************************<span></span></pre></td></tr><tr><td scope="row"><pre> Handling Incoming Profiles<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> When the app receives a profile it displays it own view to give a chance to look at the profile and decide if they want it.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> There are two considerations when displaying a save view for the user.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> First the user could be doing an important task that this save view is going to interrupt. To account for this the app displays the save view in its own window, which will not disturb the main window's contents.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> Second while the user is deciding if they want to keep the profile, another one could arrive. Because of this possibility, this app keeps a queue of arriving profiles.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> When the first profile arrives a navigation controller is created to display that profile in a APLProfileViewController.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> When each subsequent profile arrives they are enqueued. Once the user decides whether or not to save the displayed profile, the next profile is pushed onto the navigation controller's stack.<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> ******************************************************/<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)enqueueProfile:(APLProfile *)profile<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    if (!_receivedProfileQueue) {<span></span></pre></td></tr><tr><td scope="row"><pre>        _receivedProfileQueue = [NSMutableArray array];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    @synchronized(self.receivedProfileQueue)<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        [self.receivedProfileQueue addObject:profile];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //If first recevied, profile present<span></span></pre></td></tr><tr><td scope="row"><pre>        if (self.receivedProfileQueue.count == 1) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [self presentFirstProfile];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (APLProfile *)dequeueProfile<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    @synchronized(self.receivedProfileQueue) {<span></span></pre></td></tr><tr><td scope="row"><pre>        APLProfile *profile = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>        if (self.receivedProfileQueue.count &gt; 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>            profile = [self.receivedProfileQueue firstObject];<span></span></pre></td></tr><tr><td scope="row"><pre>            [self.receivedProfileQueue removeObject:profile];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        return profile;<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)presentFirstProfile<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    APLProfile *profile = [self.receivedProfileQueue firstObject];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    if (profile) {<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Notify observers that the save window will appear<span></span></pre></td></tr><tr><td scope="row"><pre>        [[NSNotificationCenter defaultCenter] postNotificationName:DisplayingSaveWindowNotification object:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Create Window<span></span></pre></td></tr><tr><td scope="row"><pre>        self.saveReceivedWindow = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];<span></span></pre></td></tr><tr><td scope="row"><pre>        [self.saveReceivedWindow setWindowLevel:UIWindowLevelNormal];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Create profileViewController to display received profile<span></span></pre></td></tr><tr><td scope="row"><pre>        APLProfileViewController *profileViewController = [self createProfileViewControllerForProfile:profile];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Create a navigation controller to handle displaying multiple incoming profiles<span></span></pre></td></tr><tr><td scope="row"><pre>        UINavigationController *nav = [[UINavigationController alloc] initWithRootViewController:profileViewController];<span></span></pre></td></tr><tr><td scope="row"><pre>        self.receivedProfilesNavigationController = nav;<span></span></pre></td></tr><tr><td scope="row"><pre>        [self.saveReceivedWindow setRootViewController:nav];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Set frame below the screen<span></span></pre></td></tr><tr><td scope="row"><pre>        CGRect originalFrame = self.saveReceivedWindow.frame;<span></span></pre></td></tr><tr><td scope="row"><pre>        CGRect newFrame = self.saveReceivedWindow.frame;<span></span></pre></td></tr><tr><td scope="row"><pre>        newFrame.origin.y = newFrame.origin.y + newFrame.size.height;<span></span></pre></td></tr><tr><td scope="row"><pre>        self.saveReceivedWindow.frame = newFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Create animation to have window slide up from bottom of the screen<span></span></pre></td></tr><tr><td scope="row"><pre>        [self.saveReceivedWindow makeKeyAndVisible];<span></span></pre></td></tr><tr><td scope="row"><pre>        [UIView animateWithDuration:0.4f<span></span></pre></td></tr><tr><td scope="row"><pre>                              delay:0.0f<span></span></pre></td></tr><tr><td scope="row"><pre>                            options:UIViewAnimationOptionCurveEaseInOut<span></span></pre></td></tr><tr><td scope="row"><pre>                         animations:^{<span></span></pre></td></tr><tr><td scope="row"><pre>                             self.saveReceivedWindow.frame = originalFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>                         }<span></span></pre></td></tr><tr><td scope="row"><pre>                         completion:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)presentNextProfile<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    APLProfile *profile = [self.receivedProfileQueue firstObject];<span></span></pre></td></tr><tr><td scope="row"><pre>    if (profile) {<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        APLProfileViewController *profileViewController = [self createProfileViewControllerForProfile:profile];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        //Make sure navigation controller exists<span></span></pre></td></tr><tr><td scope="row"><pre>        if (self.receivedProfilesNavigationController) {<span></span></pre></td></tr><tr><td scope="row"><pre>            [self.receivedProfilesNavigationController pushViewController:profileViewController animated:YES];<span></span></pre></td></tr><tr><td scope="row"><pre>        }<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>     }<span></span></pre></td></tr><tr><td scope="row"><pre>    else if (self.receivedProfilesNavigationController) //Queue is empty<span></span></pre></td></tr><tr><td scope="row"><pre>    {<span></span></pre></td></tr><tr><td scope="row"><pre>        //Animate the window away (slide down)<span></span></pre></td></tr><tr><td scope="row"><pre>        [UIView animateWithDuration:0.4f<span></span></pre></td></tr><tr><td scope="row"><pre>                              delay:0.0f<span></span></pre></td></tr><tr><td scope="row"><pre>                            options:UIViewAnimationOptionCurveEaseInOut<span></span></pre></td></tr><tr><td scope="row"><pre>                         animations:^{<span></span></pre></td></tr><tr><td scope="row"><pre>                             [self.saveReceivedWindow resignKeyWindow];<span></span></pre></td></tr><tr><td scope="row"><pre>                             <span></span></pre></td></tr><tr><td scope="row"><pre>                             CGRect newFrame = self.saveReceivedWindow.frame;<span></span></pre></td></tr><tr><td scope="row"><pre>                             newFrame.origin.y = newFrame.origin.y + newFrame.size.height;;<span></span></pre></td></tr><tr><td scope="row"><pre>                             self.saveReceivedWindow.frame = newFrame;<span></span></pre></td></tr><tr><td scope="row"><pre>                         }<span></span></pre></td></tr><tr><td scope="row"><pre>                         completion:^(BOOL finished) {<span></span></pre></td></tr><tr><td scope="row"><pre>                             <span></span></pre></td></tr><tr><td scope="row"><pre>                             self.saveReceivedWindow = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>                             self.receivedProfilesNavigationController = nil;<span></span></pre></td></tr><tr><td scope="row"><pre>                             <span></span></pre></td></tr><tr><td scope="row"><pre>                             //Only show profile table if at least one profile was saved<span></span></pre></td></tr><tr><td scope="row"><pre>                             if ([self.savedFileNames count] &gt; 0) {<span></span></pre></td></tr><tr><td scope="row"><pre>                                 <span></span></pre></td></tr><tr><td scope="row"><pre>                                 NSDictionary *userInfo = @{kSavedReceivedProfilesFileNamesKey : [self.savedFileNames copy]};<span></span></pre></td></tr><tr><td scope="row"><pre>                                 <span></span></pre></td></tr><tr><td scope="row"><pre>                                 //Notify observers at least one profile was saved<span></span></pre></td></tr><tr><td scope="row"><pre>                                 [[NSNotificationCenter defaultCenter] postNotificationName:SavedReceivedProfilesNotification object:nil userInfo:userInfo];<span></span></pre></td></tr><tr><td scope="row"><pre>                                 <span></span></pre></td></tr><tr><td scope="row"><pre>                                 //Show profile table if currently in the sharing types table, otherwise don't, the user could be in the middle of something<span></span></pre></td></tr><tr><td scope="row"><pre>                                 if ([self.navigationController visibleViewController] == self.sharingTypesViewController) {<span></span></pre></td></tr><tr><td scope="row"><pre>                                     [self.sharingTypesViewController showProfilesTable];<span></span></pre></td></tr><tr><td scope="row"><pre>                                 }<span></span></pre></td></tr><tr><td scope="row"><pre>                                 <span></span></pre></td></tr><tr><td scope="row"><pre>                                 [self.savedFileNames removeAllObjects];<span></span></pre></td></tr><tr><td scope="row"><pre>                             }<span></span></pre></td></tr><tr><td scope="row"><pre>                         }];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)saveProfile:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    APLProfile *profile = [self dequeueProfile];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    if (profile) {<span></span></pre></td></tr><tr><td scope="row"><pre>        //Save profile to persistent file<span></span></pre></td></tr><tr><td scope="row"><pre>        [APLUtilities saveProfile:profile];<span></span></pre></td></tr><tr><td scope="row"><pre>        <span></span></pre></td></tr><tr><td scope="row"><pre>        [self.savedFileNames addObject:[profile filename]];<span></span></pre></td></tr><tr><td scope="row"><pre>    }<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    [self presentNextProfile];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (void)discardProfile:(id)sender<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    [self dequeueProfile];<span></span></pre></td></tr><tr><td scope="row"><pre>    [self presentNextProfile];<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>- (APLProfileViewController *)createProfileViewControllerForProfile:(APLProfile *)profile<span></span></pre></td></tr><tr><td scope="row"><pre>{<span></span></pre></td></tr><tr><td scope="row"><pre>    UIStoryboard *sb = [UIStoryboard storyboardWithName:kMainStoryboardName bundle:nil];<span></span></pre></td></tr><tr><td scope="row"><pre>    APLProfileViewController *profileViewController = [sb instantiateViewControllerWithIdentifier:kProfileViewControllerIdentifier];<span></span></pre></td></tr><tr><td scope="row"><pre>    profileViewController.profile = profile;<span></span></pre></td></tr><tr><td scope="row"><pre>    profileViewController.interactive = NO;<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    UIBarButtonItem *cancelButton = [[UIBarButtonItem alloc] initWithTitle:@"Discard"<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                     style:UIBarButtonItemStylePlain<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                    target:self<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                    action:@selector(discardProfile:)];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    UIBarButtonItem *saveButton = [[UIBarButtonItem alloc] initWithBarButtonSystemItem:UIBarButtonSystemItemSave<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                                target:self<span></span></pre></td></tr><tr><td scope="row"><pre>                                                                                action:@selector(saveProfile:)];<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    profileViewController.navigationItem.leftBarButtonItem = cancelButton;<span></span></pre></td></tr><tr><td scope="row"><pre>    profileViewController.navigationItem.rightBarButtonItem = saveButton;<span></span></pre></td></tr><tr><td scope="row"><pre>    <span></span></pre></td></tr><tr><td scope="row"><pre>    return profileViewController;<span></span></pre></td></tr><tr><td scope="row"><pre>}<span></span></pre></td></tr><tr><td scope="row"><pre> <span></span></pre></td></tr><tr><td scope="row"><pre>@end<span></span></pre></td></tr></table></div>

        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            <a class='nextLink' rel='next' href='https://developer.apple.com/library/ios/samplecode/sc2273/Listings/AirDropSample_APLAsyncImageActivityItemProvider_h.html'>Next</a><a class='previousLink' rel='prev' href='AirDropSample_APLAppDelegate_h.html'>Previous</a>
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2013 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2013-10-17</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <input id="email" type="email" name="email" placeholder="Email (optional)" size="48">

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="../../../../../bug-reporting/index.html" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../../Resources/874/JavaScript/lib/prototype.js"></script>
    <script src="../../../Resources/874/JavaScript/library.js"></script>
    <script src="../../../Resources/874/JavaScript/feedback.js"></script>
</body>
<script type="text/javascript" src="../../../../webstats/pagetracker.js"></script>
<script type="text/javascript">
if(typeof PageTracker !== 'undefined') {
  if(window.addEventListener) {
    window.addEventListener("load", function(){PageTracker.logPageLoad()},false);
  } else if(window.attachEvent) {
    window.attachEvent("onload",function(){PageTracker.logPageLoad()});
  }
}
</script>
</html>
