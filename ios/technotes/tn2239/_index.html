<!DOCTYPE html>
<html lang="en">
<head>
    <title>Technical Note TN2239: iOS Debugging Magic</title>
    <meta http-equiv="X-UA-Compatible" content="IE=7">
    <meta charset="utf-8">
    <meta id="book-resource-type" name="book-resource-type" content="Technical Note">
    <meta scheme="apple_ref" id="identifier" name="identifier" content="//apple_ref/doc/uid/DTS40010638">
	<meta id="document-version" name="document-version" content="1.1.0">
    <meta id="build" name="build" content="bcf073e0579478458b78c3b3068a2133">
    <meta id="chapterId" name="chapterId" content="DTS40010638-CH1">
    <meta id="date" name="date" content="2011-01-22">
    <meta id="description" name="description" content="TN2239: describes a large collection of iOS debugging hints and tips.">
    <meta id="book-title" name="book-title" content="iOS Debugging Magic">
    <meta id="book-name" name="book-name" contents="DTS_TN2239_iOSDebuggingMagi">
    <meta id="book-root" name="book-root" content="./">
    <meta id="book-json" name="book-json" content="book.json">
    <meta id="devcenter" name="devcenter" content="iOS Dev Center">
    <meta id="devcenter-url" name="devcenter-url" content="http://developer.apple.com/devcenter/ios">
    <meta id="reflib" name="reflib" content="iOS Developer Library">
    <meta id="book-assignments" name="book-assignments" content="{Type/Technical Note}, {Topic/General}">
    
    
    <meta id="generator" name="generator" content="Gutenberg 003a3034">
    <meta name='numbat' content='aa879094b666337fdcde744b62fbff30'>
    <meta id="copyright" name="copyright" content="Copyright 2014 Apple Inc. All Rights Reserved.">
    <meta id="xcode-display" name="xcode-display" content="render">
    <meta id="IndexTitle" name="IndexTitle" content="Technical Note TN2239">
    <meta id="resources-uri" name="resources-uri" content="../../Resources/874">
    <link id="book-index-page" rel="Start" title="iOS Debugging Magic" type="text/html" href="index.html">
    <link id="next-page" rel="Next" type="text/html" href="">
    <link id="previous-page" rel="Prev" type="text/html" href="">
    <link rel="stylesheet" type="text/css" href="../../Resources/874/CSS/screen.css">
    
    <link rel="stylesheet" type="text/css" href="../../Resources/874/CSS/feedback.css">
</head>    
<body><a name="//apple_ref/doc/uid/DTS40010638" title="Technical Note TN2239"></a>
    <div id="adcHeader" class="hideOnPrint hideInXcode">
        <div id='ssi_Header' class="hideInXcode phone">
            <a id="ssi_LibraryTitle" href='../../navigation/index.html'>iOS Developer Library</a>
            <a id="ssi_AppleDeveloperConnection" href='../../../../index.html'>Developer</a>
            <div id='ssi_SearchButton' role="button" title="Search">Search</div>
        </div>
        <form id='ssi_SearchMenu' method='get' action='../../search/' accept-charset='utf-8'>
            <label for='adcsearch'>Search iOS Developer Library</label>
            <input type='search' id='ssi_SearchField' name='q' accesskey='s' results='5' />
        </form>
    </div>

    <header id="header">
        <div id="title" role="banner">
            <h1>iOS Debugging Magic</h1>
            <span id="file_links">
                <a id="PDF_link" role="button" tabindex='4' rel="alternate" title="Download PDF"><span id="pdf_icon"></span>PDF</a>
                <a id="Companion_link" role="button" tabindex='3' title="Download Companion File"><span id="companion_icon"></span>Companion File</a>
            </span>
        </div>
        <ul id="headerButtons" class="hideOnPrint" role="toolbar">
            <li id="toc_button" style="display:none">
                <button tabindex="5" id="table_of_contents" class="open" role="checkbox" aria-label="Show Table of Contents"><span class="disclosure"></span>Table of Contents</button>
            </li>
            <li id="jumpto_button" style="display:none" role="navigation"><select tabindex="6" id="jumpTo"><option value="top">Jump To&#133;</option></select></li>
            <li id="downloadSample_button" style="display:none">
                <a id="Sample_link"><button id="Sample_button">Download Sample Code</button></a>
            </li>
        </ul>
    </header>
    <nav id="tocContainer" tabindex="7">
        <ul id="toc" role="tree"></ul>
    </nav>

    <article id="contents" tabindex="0" role="main" class="dts_doc">
        <!-- CONTENTS -->
        <div id="pageNavigationLinks_top" class="pageNavigationLinks">
            
        </div>
        <a id="top" name="top"></a>
        <a id="INDEX" href="index.html" style="display:none;"></a>
        
        <a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_2" title="Technical Note TN2239"></a><div class="dtsDocNumber">Technical Note TN2239</div><h1 id="pageTitle">iOS Debugging Magic</h1><p>iOS contains a number of 'secret' debugging facilities, including environment variables, preferences, routines callable from GDB, and so on. This technote describes these facilities. If you're developing for iOS, you should look through this list to see if you're missing out on something that will make your life easier.</p>

   
    <div class="outerMiniTOC">

        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION1">Introduction</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION2">Basics</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION2">Enabling Debugging Facilities</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION7">Seeing Debug Output</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION10">Some Assembly Required</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION10">ARM</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION11">Intel 32-Bit</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION12">Architecture Gotchas</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION15">Controlled Crash</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION17">Instruments</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION18">CrashReporter</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION19">BSD</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION19">Memory Allocator</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION20">Standard C++ Library</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION21">Dynamic Linker (dyld)</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION23">Core Services</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION23">Core Foundation</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION26">Application Services</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION26">Core Animation</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION28">Cocoa and Cocoa Touch</a>
                
                
                
                    <div class="nestedMiniTOC">
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION28">Objective-C</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION30">Foundation</a>
                            
                        </div>
                        
                    
                        
                        <div>
                            <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION34">UIKit</a>
                            
                        </div>
                        
                    
                    </div>
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION36">Networking</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION37">Power</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION38">Push Notifications</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-CH1-SECTION39">iPhone Simulator</a>
                
                
                
            </div>
            
        
			
            <div>
                <a href="_index.html#/apple_ref/doc/uid/DTS40010638-RevisionHistory-DontLinkElementID_1">Document Revision History</a>
                
                
                
            </div>
            
        
    </div>

<section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION1" title="Introduction"></a><h2 class="jump">Introduction</h2><p>All Apple systems include debugging facilities added by Apple engineering teams to help develop and debug specific subsystems. Many of these facilities remain in released system software and you can use them to debug your code. This technote describes some of the more broadly useful ones. In cases where a debugging facility is documented in another place, there's a short overview of the facility and a link to the existing documentation.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_3" title="Important"></a><p><strong>Important:</strong>&nbsp;This is not an exhaustive list: not all debugging facilities are, or will be, documented.</p><p></p></aside></div><p>Many of the details covered in this technote vary from platform to platform and release to release. As such, you may encounter minor variations between platforms, and on older or newer systems. Known significant variations are called out in the text.</p><p>This technote was written with reference to iOS 4.1.</p><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_4" title="Warning"></a><p><strong>Warning:</strong>&nbsp;The debugging facilities described in this technote are unsupported. Apple reserves the right to change or eliminate each facility as dictated by the evolution of the OS; this has happened in the past, and is very likely to happen again in the future. <strong>These facilities are for debugging only: you must not ship a product that relies on the existence or functionality of the facilities described in this technote.</strong></p><p></p><div class="clear"></div></aside></div><p>In addition to this technical issue of binary compatibility, keep in mind that iOS applications must comply with various legal agreements and the App Store Review Guidelines.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_5" title="Note"></a><p><strong>Note:</strong>&nbsp;If you also develop for Mac OS X, you may want to read <span class="content_text"><a href="../../../mac/technotes/tn2124/index.html" class="urlLink" rel="external">Technical Note TN2124, 'Mac OS X Debugging Magic'</a></span>.</p><p></p></aside></div><p>This technote covers advanced debugging techniques. If you're just getting started, you should consult the following material:</p><ul class="ul"><li class="li"><p>GDB is the system's primary debugging tool. For a full description of GDB, see <span class="content_text"><a href="../../../mac/index.html#documentation/DeveloperTools/gdb/gdb/gdb_toc.html" class="browserLink" >Debugging with GDB</a></span>.</p></li><li class="li"><p>Xcode is Apple's integrated development environment (IDE). It includes a sophisticated graphical debugger, implemented as a wrapper around GDB. For more information about Xcode, see the "Tools &amp; Languages" section of the Apple developer <span class="content_text"><a href="../../../mac/navigation/index.html" class="browserLink" >Reference Library</a></span>.</p></li></ul><p>This technote does not cover performance debugging. If you're trying to debug a performance problem, the best place to start is the <span class="content_text"><a href="../../index.html#referencelibrary/GettingStarted/GS_Performance_iPhone/index.html" class="browserLink" >Getting Started with Performance</a></span> document.</p><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION2" title="Basics"></a><h2 class="jump">Basics</h2><p>The later sections of this technote describe the debugging facilities in detail. Many of these facilities use similar techniques to enable and disable the facility, and to see its output. This section describes these common techniques.</p><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION2" title="Enabling Debugging Facilities"></a><h3 class="jump">Enabling Debugging Facilities</h3><p>Some debugging facilities are enabled by default. However, most facilities must be enabled using one of the techniques described in the following sections.</p><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION2" title="Environment Variables"></a><h4 class="jump">Environment Variables</h4><p>In many cases you can enable a debugging facility by setting a particular environment variable. You can do this using the executable inspector in Xcode. <span class="content_text"><!--a  -->Figure 1<!--/a--></span> shows an example of this.</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS40010638-CH1-FIGURE1" title="Figure 1Setting environment variables in Xcode"></a><figcaption><strong class="caption_number">Figure 1</strong>&nbsp;&nbsp;Setting environment variables in Xcode</figcaption><img src="Art/tn2239_XcodeEnv.png" class="wide-image" alt="" width="687" height="749"><img src="Art/tn2239_XcodeEnv.png" class="ipad-scaled-image" alt="" width="670" height="730"></figure></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION3" title="Preferences"></a><h4 class="jump">Preferences</h4><p>Some debugging facilities are enabled by setting a special preference. You can set such a debugging preference by configuring a command line argument in Xcode. <span class="content_text"><!--a  -->Figure 2<!--/a--></span> shows how this is done.</p><figure class="figure"><a name="//apple_ref/doc/uid/DTS40010638-CH1-FIGURE2" title="Figure 2Setting command line arguments in Xcode"></a><figcaption><strong class="caption_number">Figure 2</strong>&nbsp;&nbsp;Setting command line arguments in Xcode</figcaption><img src="Art/tn2239_XcodeArgs.png" class="wide-image" alt="" width="681" height="749"><img src="Art/tn2239_XcodeArgs.png" class="ipad-scaled-image" alt="" width="670" height="736"></figure></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION4" title="Callable Routines"></a><h4 class="jump">Callable Routines</h4><p>Many system frameworks include routines that print debugging information to <code>stderr</code>. These routines may be specifically designed to be callable from within GDB, or they may just be existing API routines that are useful while debugging. <span class="content_text"><!--a  -->Listing 1<!--/a--></span> shows an example of how to call a debugging routine from GDB; specifically, it calls <code>CFBundleGetAllBundles</code> to get a list of all the bundles loaded in the application, and then prints that list by calling the <code>CFShow</code> routine.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE1" title="Listing 1Calling a debugging routine from GDB"></a><p class="codesample clear"><strong class="caption_number">Listing 1</strong>&nbsp;&nbsp;Calling a debugging routine from GDB</p><div class="codesample clear"><table><tr><td scope="row"><pre>(gdb) call (void)CFShow((void *)CFBundleGetAllBundles())
&lt;CFArray 0x10025c010 [0x7fff701faf20]&gt;{type = mutable-small, count = 59, values = (
    0 : CFBundle 0x100234d00 &lt;/System/Library/Frameworks/CoreData.framework&gt; …
    […]
    12 : CFBundle 0x100237790 &lt;/System/Library/Frameworks/Security.framework&gt; …
    […]
    23 : CFBundle 0x100194eb0 &lt;/System/Library/Frameworks/CoreFoundation.framework&gt; …
    […]
)}<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_6" title="Note"></a><p><strong>Note:</strong>&nbsp;When calling a routine like this, GDB must know the routine's return type (because some return types can affect the way in which parameters are passed). If you're calling a routine without debug symbols, you have to tell GDB the return type by adding a cast. For example, <span class="content_text"><!--a  -->Listing 1<!--/a--></span> casts the return type of <code>CFBundleGetAllBundles</code> to <code>(void *)</code> and the return type of <code>CFShow</code> to <code>(void)</code>.</p><p></p></aside></div><p>Similarly, if you call a routine with <span class="content_text"><!--a  -->non-standard parameters<!--/a--></span>, you may need to cast your arguments to ensure that GDB passes them correctly.</p><p>If you don't see the output from the routine, you may need to look at the console log, as described in the <span class="content_text"><!--a  -->Seeing Debug Output<!--/a--></span> section.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_7" title="Important"></a><p><strong>Important:</strong>&nbsp;If you use this technique for your own code, be warned that it doesn't always work for routines that are declared <code>static</code>. The compiler's interprocedural optimizations may cause a static routine to deviate from the standard function call <span class="content_text"><a href="http://en.wikipedia.org/wiki/Application_binary_interface" class="urlLink" rel="external">ABI</a></span>. In that case, it can't be reliably called by GDB.</p><p></p></aside></div><p>In practice, this only affects Intel 32-bit code, as used by the iPhone Simulator.</p></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION5" title="Configuration Profiles"></a><h4 class="jump">Configuration Profiles</h4><p>Some iOS subsystems have debugging facilities that can be enabled by installing a special configuration profile. For an example of this, see <span class="content_text"><!--a  -->Push Notifications<!--/a--></span>. You install such a configuration profile in the usual way:</p><ul class="ul"><li class="li"><p>put it on a web server, and then download it using Safari on the device</p></li><li class="li"><p>attach it to an email, mail it to an account accessible from the device, and then run Mail and open the configuration profile attachment</p></li></ul><p>You can learn more about configuration profiles by reading the various documents accessible from <span class="content_text"><a href="http://www.apple.com/iphone/business/" class="urlLink" rel="external">iPhone in Business</a></span> site.</p></section></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION7" title="Seeing Debug Output"></a><h3 class="jump">Seeing Debug Output</h3><p>Programs that generate debug output generally do so using one of following mechanisms:</p><ul class="ul"><li class="li"><p><code>NSLog</code></p></li><li class="li"><p>printing to <code>stderr</code></p></li><li class="li"><p>system log</p></li></ul><p><code>NSLog</code> is a high-level API for logging which is used extensively by Objective-C code. The exact behaviour of <code>NSLog</code> is surprisingly complex, and has changed significantly over time, making it beyond the scope of this document. However, it's sufficient to know that <code>NSLog</code> prints to <code>stderr</code>, or logs to the system log, or both. So, if you understand those two mechanisms, you can see anything logged via <code>NSLog</code>.</p><p>Printing to <code>stderr</code> is one of the most commonly used output mechanisms. Given this topic's importance, it is covered in depth in the <span class="content_text"><!--a  -->next section<!--/a--></span>.</p><p>The easiest way to view the system log is in the Console tab in Xcode's Organizer window. If you're working with users who don't want to install Xcode, they can view the system log using the <span class="content_text"><a href="http://www.apple.com/support/iphone/enterprise/" class="urlLink" rel="external">iPhone Configuration Utility</a></span>.</p><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION7" title="Console Output"></a><h4 class="jump">Console Output</h4><p>Many programs, and indeed many system frameworks, print debugging messages to <code>stderr</code>. The destination for this output is ultimately controlled by the program: it can redirect <code>stderr</code> to whatever destination it chooses. However, in most cases a program does not redirect <code>stderr</code>, so the output goes to the default destination inherited by the program from its launch environment. This is typically one of the following:</p><ul class="ul"><li class="li"><p>If you launch a GUI application as it would be launched by a normal user, the system redirects any messages printed on <code>stderr</code> to the system log. You can view these messages using the techniques <span class="content_text"><!--a  -->described earlier<!--/a--></span>.</p></li><li class="li"><p>If you run a program from within Xcode, you can see its <code>stderr</code> output in Xcode's debugger Console window (choose the Console menu item from the Run menu to see this window).</p></li></ul><p>Attaching to a running program (using Xcode's Attach to Process menu, or the <code>attach</code> command in GDB) does not automatically connect the program's <code>stderr</code> to your GDB window. You can do this from within GDB using the trick described in the "Seeing stdout and stderr After Attaching" section of <span class="content_text"><a href="../../../mac/navigation/topic_details/resourceType_2.html" class="urlLink" rel="external">Technical Note TN2030, 'GDB for MacsBug Veterans'</a></span>.</p></section></section><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION10" title="Some Assembly Required"></a><h2 class="jump">Some Assembly Required</h2><p>While it's very unusual to write a significant amount of code in assembly language these days, it's still useful to have a basic understanding of that dark art. This is particularly true when you're debugging, especially when you're debugging crashes that occur in libraries or frameworks for which you don't have the source code. This section covers some of the most basic techniques necessary to debug programs at the assembly level. Specifically, it describes how to set breakpoints, access parameters, and access the return address on all supported architectures.</p><p>Where the difference is significant the assembly-level examples in this technote are from an <code>armv7</code> binary running on an iPhone 3GS. However, in most cases the difference is not significant and the example might be from a variety of different architectures, perhaps even from the Mac. It's very easy to adapt such examples to other architectures. The most significant differences are:</p><ul class="ul"><li class="li"><p>accessing parameters</p></li><li class="li"><p>getting the return address</p></li></ul><p>And these are exactly the items covered by the following architecture-specific sections.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_8" title="Important"></a><p><strong>Important:</strong>&nbsp;The following architecture-specific sections contain rules of thumb. If the routine has any non-standard parameters, or a non-standard function result, these rules of thumb do not apply, and you should consult the documentation for the details.</p><p></p></aside></div><p>In this context, <strong>standard parameters</strong> are integers (that fit in a single register), enumerations, and pointers (including pointers to arrays and pointers to functions). Non-standard parameters are floating point numbers, vectors, structures, integers bigger than a register, and any parameter after the last fixed parameter of a routine that takes a variable number of arguments.</p><p>For a detailed description of the calling conventions for all iOS devices, see <span class="content_text"><a href="../../index.html#documentation/Xcode/Conceptual/iPhoneOSABIReference/Introduction/Introduction.html" class="browserLink" >iOS ABI Function Call Guide</a></span>. The Intel 32-bit architecture used by the iPhone Simulator is described in the <span class="content_text"><a href="../../../mac/index.html#documentation/DeveloperTools/Conceptual/LowLevelABI/000-Introduction/introduction.html" class="browserLink" >Mac OS X ABI Function Call Guide</a></span>.</p><p>Before you read the following sections, it's critical that you understand one GDB subtlety. Because GDB is, at heart, a source-level debugger, when you set a breakpoint on a routine, GDB does not set the breakpoint on the first instruction of the routine; rather, it sets the breakpoint at the first instruction after the routine's <span class="content_text"><a href="http://en.wikipedia.org/wiki/Function_prologue" class="urlLink" rel="external">prologue</a></span>. From a source-level debugging point of view this make perfect sense. In a source-level debugger you never want to step through the routine's prologue. However, when doing assembly-level debugging, it's easier to access parameters before the prologue runs. That's because the location of the parameters at the first instruction of a routine is determined by the function call <span class="content_text"><a href="http://en.wikipedia.org/wiki/Application_binary_interface" class="urlLink" rel="external">ABI</a></span>, but the prologue is allowed to shuffle things around at its discretion. Moreover, each prologue can do this in a slightly different way. So the only way to access parameters after the prologue has executed is to disassemble the prologue and work out where everything went. This is typically, but not always, quite easy, but it's still extra work.</p><p>The best way to tell GDB to set a breakpoint at the first instruction of a routine is to prefix the routine name with a "*". <span class="content_text"><!--a  -->Listing 2<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE2" title="Listing 2Before and after the prologue"></a><p class="codesample clear"><strong class="caption_number">Listing 2</strong>&nbsp;&nbsp;Before and after the prologue</p><div class="codesample clear"><table><tr><td scope="row"><pre>(gdb) b CFStringCreateWithFormat
Breakpoint 1 at 0x34427ff8
(gdb) info break
Num Type           Disp Enb Address    What
1   breakpoint     keep n   0x34427ff8 &lt;CFStringCreateWithFormat+8&gt;
-- The breakpoint is not at the first instruction.
-- Disassembling the routine shows that GDB has skipped the prologue.
(gdb) x/5i CFStringCreateWithFormat
0x34427ff0 &lt;CFStringCreateWithFormat&gt;: push    {r2, r3}
0x34427ff2 &lt;CFStringCreateWithFormat+2&gt;: push    {r7, lr}
0x34427ff4 &lt;CFStringCreateWithFormat+4&gt;: add r7, sp, #0
0x34427ff6 &lt;CFStringCreateWithFormat+6&gt;: sub sp, #4
0x34427ff8 &lt;CFStringCreateWithFormat+8&gt;: add r3, sp, #12
-- So we use a "*" prefix to disable GDB's 'smarts'.
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x34427ff0
(gdb) info break
Num Type           Disp Enb Address    What
1   breakpoint     keep n   0x34427ff8 &lt;CFStringCreateWithFormat+8&gt;
2   breakpoint     keep n   0x34427ff0 &lt;CFStringCreateWithFormat&gt;<span></span></pre></td></tr></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_9" title="Important"></a><p><strong>Important:</strong>&nbsp;Because iOS has no way to run programs from the command line, iOS-specific listings, like <span class="content_text"><!--a  -->Listing 2<!--/a--></span>, are taken from Xcode's Console window. And because the Console window does not support the '#' character for comments, comments are denoted by a leading '--'. If you try to replicate these examples yourself, you must not enter these lines into the Console window.</p><p></p></aside></div><p>In contrast, some other listings in this document were created on Mac OS X, and thus use traditional GDB comments.</p><p>Finally, if you're looking for information about specific instructions, be aware that the Help menu in Shark (included in the Xcode developer tools) has an instruction set reference for ARM, Intel and PowerPC architectures.</p><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION10" title="ARM"></a><h3 class="jump">ARM</h3><p>In ARM programs the first four parameters are passed in registers. The return address is in register LR. <span class="content_text"><!--a  -->Table 1<!--/a--></span> shows how to access these values from GDB when you've stopped at the first instruction of the function.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE1" title="Table 1Accessing parameters on ARM"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 1</strong>&nbsp;&nbsp;Accessing parameters on ARM</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
What
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Syntax
</p></th></tr><tr><td  scope="row"><p>
return address
</p></td><td ><p>
$lr
</p></td></tr><tr><td  scope="row"><p>
first parameter
</p></td><td ><p>
$r0
</p></td></tr><tr><td  scope="row"><p>
second parameter
</p></td><td ><p>
$r1
</p></td></tr><tr><td  scope="row"><p>
third parameter
</p></td><td ><p>
$r2
</p></td></tr><tr><td  scope="row"><p>
fourth parameter
</p></td><td ><p>
$r3
</p></td></tr></table></div><p>On return from a function the result is in register R0 (<code>$r0</code>).</p><p>Because parameters are passed in registers, there's no straightforward way to access parameters after the prologue.</p><p><span class="content_text"><!--a  -->Listing 3<!--/a--></span> shows an example of how to use this information to access parameters in GDB.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE3" title="Listing 3Parameters on ARM"></a><p class="codesample clear"><strong class="caption_number">Listing 3</strong>&nbsp;&nbsp;Parameters on ARM</p><div class="codesample clear"><table><tr><td scope="row"><pre>-- We have to start the program from Xcode. Before we do that, we go to 
-- Xcode's Breakpoints window and set a symbolic breakpoint on 
-- CFStringCreateWithFormat.
GNU gdb 6.3.50-20050815 […]
-- We've stopped after the prologue.
(gdb) p/a $pc
$1 = 0x34427ff8 &lt;CFStringCreateWithFormat+8&gt;
-- Let's see what the prologue has done to the registers 
-- holding our parameters.
(gdb) x/5i $pc-8
0x34427ff0 &lt;CFStringCreateWithFormat&gt;: push    {r2, r3}
0x34427ff2 &lt;CFStringCreateWithFormat+2&gt;: push    {r7, lr}
0x34427ff4 &lt;CFStringCreateWithFormat+4&gt;: add r7, sp, #0
0x34427ff6 &lt;CFStringCreateWithFormat+6&gt;: sub sp, #4
0x34427ff8 &lt;CFStringCreateWithFormat+8&gt;: add r3, sp, #12
-- Hey, the prologue hasn't modified R0..R3, so we're OK.
--
-- first parameter is "alloc"
(gdb) p/a $r0
$2 = 0x3e801d60 &lt;__kCFAllocatorSystemDefault&gt;
-- second parameter is "formatOptions"
(gdb) p/a $r1
$3 = 0x0
-- third parameter is "format"
(gdb) call (void)CFShow($r2)
managed/%@/%@
-- It turns out the prologue has left LR intact as well.
-- So we can get our return address.
--
-- IMPORTANT: Bit zero of the return address indicates that it lies 
-- in a Thumb routine. So when using a return address in LR or on 
-- the stack, always mask off bit zero.
(gdb) p/a $lr &amp; 0xfffffffe
$4 = 0x34427e18 &lt;__CFXPreferencesGetManagedSourceForBundleIDAndUser+48&gt;
-- Now clear the breakpoint and set a new one before the prologue.
(gdb) del 1
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x34427ff0
(gdb) c
Continuing.

Breakpoint 2, 0x34427ff0 in CFStringCreateWithFormat ()
-- We're at the first instruction. The parameters are guaranteed 
-- to be in the right registers.
(gdb) p/a $pc
$5 = 0x34427ff0 &lt;CFStringCreateWithFormat&gt;
-- first parameter is "alloc"
(gdb) p/a $r0
$6 = 0x3e801d60 &lt;__kCFAllocatorSystemDefault&gt;
-- second parameter is "formatOptions"
(gdb) p/a $r1
$7 = 0x0
-- third parameter is "format"
(gdb) call (void)CFShow($r2)
%@/%@.plist
-- return address is in LR; again, we mask off bit zero
(gdb) p/a $lr &amp; 0xfffffffe
$8 = 0x34427e7c &lt;__CFXPreferencesGetManagedSourceForBundleIDAndUser+148&gt;
(gdb) b *0x34427e7c
Breakpoint 3 at 0x34427e7c
-- Delete the other breakpoint to avoid thread-based confusion.
(gdb) del 2
-- Continue to the return address.
(gdb) c
Continuing.

Breakpoint 3, 0x34427e7c in __CFXPreferencesGetManagedSourceForBundleIDAndUser ()
-- function result
(gdb) p/a $r0
$9 = 0x1062d0
(gdb) call (void)CFShow($r0)
mobile/.GlobalPreferences.plist<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION11" title="Intel 32-Bit"></a><h3 class="jump">Intel 32-Bit</h3><p>The Intel 32-bit architecture is used in the iPhone Simulator.</p><p>In 32-bit Intel programs, parameters are passed on the stack. At the first instruction of a routine the top word of the stack contains the return address, the next word contains the first (leftmost) parameter, the next word contains the second parameter, and so on. <span class="content_text"><!--a  -->Table 2<!--/a--></span> shows how to access these values from GDB.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE2" title="Table 2Accessing parameters on Intel 32-bit"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 2</strong>&nbsp;&nbsp;Accessing parameters on Intel 32-bit</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
What
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Syntax
</p></th></tr><tr><td  scope="row"><p>
return address
</p></td><td ><p>
*(int*)$esp
</p></td></tr><tr><td  scope="row"><p>
first parameter
</p></td><td ><p>
*(int*)($esp+4)
</p></td></tr><tr><td  scope="row"><p>
second parameter
</p></td><td ><p>
*(int*)($esp+8)
</p></td></tr><tr><td  scope="row"><p>
... and so on
</p></td><td ><p>
</p></td></tr></table></div><p>After the routine's prologue you can access parameters relative to the frame pointer (register EBP). <span class="content_text"><!--a  -->Table 3<!--/a--></span> shows the syntax.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE3" title="Table 3Accessing parameters after the prologue"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 3</strong>&nbsp;&nbsp;Accessing parameters after the prologue</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
What
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Syntax
</p></th></tr><tr><td  scope="row"><p>
previous frame
</p></td><td ><p>
*(int*)$ebp
</p></td></tr><tr><td  scope="row"><p>
return address
</p></td><td ><p>
*(int*)($ebp+4)
</p></td></tr><tr><td  scope="row"><p>
first parameter
</p></td><td ><p>
*(int*)($ebp+8)
</p></td></tr><tr><td  scope="row"><p>
second parameter
</p></td><td ><p>
*(int*)($ebp+12)
</p></td></tr><tr><td  scope="row"><p>
... and so on
</p></td><td ><p>
</p></td></tr></table></div><p>On return from a function the result is in register EAX (<code>$eax</code>).</p><p><span class="content_text"><!--a  -->Listing 4<!--/a--></span> shows an example of how to use this information to access parameters in GDB.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE4" title="Listing 4Parameters on Intel 32-Bit"></a><p class="codesample clear"><strong class="caption_number">Listing 4</strong>&nbsp;&nbsp;Parameters on Intel 32-Bit</p><div class="codesample clear"><table><tr><td scope="row"><pre>$ # Use the -arch i386 argument to GDB to get it to run the 
$ # 32-bit Intel binary.
$ gdb -arch i386 /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) […]
(gdb) fb CFStringCreateWithFormat
Breakpoint 1 at 0x31ec6d6
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries […]
Breakpoint 1, 0x940e36d6 in CFStringCreateWithFormat ()
(gdb) # We've stopped after the prologue.
(gdb) p/a $pc
$1 = 0x940e36d6 &lt;CFStringCreateWithFormat+6&gt;
(gdb) # However, for 32-bit Intel we don't need to inspect 
(gdb) # the prologue because the parameters are on the stack.
(gdb) # We can access them relative to EBP.
(gdb) #
(gdb) # first parameter is "alloc"
(gdb) p/a *(int*)($ebp+8)
$2 = 0xa0473ee0 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a *(int*)($ebp+12)
$3 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow(*(int*)($ebp+16))
%@
(gdb) # return address is at EBP+4
(gdb) p/a *(int*)($ebp+4)
$4 = 0x940f59fb &lt;__CFXPreferencesGetNamedVolatileSourceForBundleID+59&gt;
(gdb) # Now clear the breakpoint and set a new one before the prologue.
(gdb) del 1
(gdb) b *CFStringCreateWithFormat
Breakpoint 2 at 0x940e36d0
(gdb) c
Continuing.

Breakpoint 2, 0x940e36d0 in CFStringCreateWithFormat ()
(gdb) # We're at the first instruction. We must access 
(gdb) # the parameters relative to ESP.
(gdb) p/a $pc
$6 = 0x940e36d0 &lt;CFStringCreateWithFormat&gt;
(gdb) # first parameter is "alloc"
(gdb) p/a *(int*)($esp+4)
$7 = 0xa0473ee0 &lt;__kCFAllocatorSystemDefault&gt;
(gdb) # second parameter is "formatOptions"
(gdb) p/a *(int*)($esp+8)
$8 = 0x0
(gdb) # third parameter is "format"
(gdb) call (void)CFShow(*(int*)($esp+12))
managed/%@/%@
(gdb) # return address is on the top of the stack
(gdb) p/a *(int*)$esp
$9 = 0x940f52cc &lt;__CFXPreferencesGetManagedSourceForBundleIDAndUser+76&gt;
(gdb) # Set a breakpoint on the return address.
(gdb) b *0x940f52cc
Breakpoint 3 at 0x940f52cc
(gdb) c
Continuing.

Breakpoint 3, 0x940f52cc in __CFXPreferencesGetManagedSourceForBundleIDAndUser ()
(gdb) # function result
(gdb) p/a $eax
$10 = 0x1079d0
(gdb) call (void)CFShow($eax)
managed/com.apple.TextEdit/kCFPreferencesCurrentUser<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION12" title="Architecture Gotchas"></a><h3 class="jump">Architecture Gotchas</h3><p>The following sections describe a couple of gotchas you might encounter when debugging at the assembly level.</p><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION12" title="Extra Parameters"></a><h4 class="jump">Extra Parameters</h4><p>When looking at parameters at the assembly level, keep in mind the following:</p><ul class="ul"><li class="li"><p>If the routine is a C++ member function, there is an implicit first parameter for <code>this</code>.</p></li><li class="li"><p>If the routine is an Objective-C method, there are two implicit first parameters (see <span class="content_text"><!--a  -->Objective-C<!--/a--></span> for details on this).</p></li><li class="li"><p>If the compiler can find all the callers of a function (this most commonly happens when the function is declared as <code>static</code>), it can choose to pass parameters to that function in a non-standard way. This is very rare on architectures that have an efficient register-based <span class="content_text"><a href="http://en.wikipedia.org/wiki/Application_binary_interface" class="urlLink" rel="external">ABI</a></span>, but it's reasonably common for Intel 32-bit programs. So, if you set a breakpoint on a static function in an Intel 32-bit program, watch out for this very confusing behavior.</p></li></ul></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION13" title="Endianness and Unit Sizes"></a><h4 class="jump">Endianness and Unit Sizes</h4><p>When examining memory in GDB, things go smoother if you use the correct unit size. <span class="content_text"><!--a  -->Table 4<!--/a--></span> is a summary of the unit sizes supported by GDB.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE4" title="Table 4GDB unit sizes"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 4</strong>&nbsp;&nbsp;GDB unit sizes</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Size
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
C Type
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
GDB Unit
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Mnemonic
</p></th></tr><tr><td  scope="row"><p>
1 byte
</p></td><td ><p>
char
</p></td><td ><p>
b
</p></td><td ><p>
byte
</p></td></tr><tr><td  scope="row"><p>
2 bytes
</p></td><td ><p>
short
</p></td><td ><p>
h
</p></td><td ><p>
half word
</p></td></tr><tr><td  scope="row"><p>
4 bytes
</p></td><td ><p>
int
</p></td><td ><p>
w
</p></td><td ><p>
word
</p></td></tr><tr><td  scope="row"><p>
8 bytes
</p></td><td ><p>
long or long long
</p></td><td ><p>
g
</p></td><td ><p>
giant
</p></td></tr></table></div><p>This is particularly important when debugging on little-endian systems (all iOS devices and the simulator) because you get confusing results if you specify the wrong unit size. <span class="content_text"><!--a  -->Listing 5<!--/a--></span> shows an example of this (taken from the Mac, but the results would be the same on an iOS device). The second and third parameters of <code>CFStringCreateWithCharacters</code> specify an array of Unicode characters. Each element is a <code>UniChar</code>, which is a 16-bit number in native-endian format. As we're running on a little-endian system, you have to dump this array using the correct unit size, otherwise everything looks messed up.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE5" title="Listing 5Using the right unit size"></a><p class="codesample clear"><strong class="caption_number">Listing 5</strong>&nbsp;&nbsp;Using the right unit size</p><div class="codesample clear"><table><tr><td scope="row"><pre>$ gdb
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) […]
(gdb) attach Finder
Attaching to process 4732.
Reading symbols for shared libraries . done
Reading symbols for shared libraries […]
0x00007fff81963e3a in mach_msg_trap ()
(gdb) b *CFStringCreateWithCharacters
Breakpoint 1 at 0x7fff86070520
(gdb) c
Continuing.

Breakpoint 1, 0x00007fff86070520 in CFStringCreateWithCharacters ()
(gdb) # The third parameter is the number of UniChars 
(gdb) # in the buffer pointed to by the first parameter.
(gdb) p (int)$rdx
$1 = 18
(gdb) # Dump the buffer as shorts. Everything makes sense.
(gdb) # This is the string "Auto-Save Recovery".
(gdb) x/18xh $rsi
0x10b7df292: 0x0041  0x0075  0x0074  0x006f  0x002d  0x0053  0x0061  0x0076
0x10b7df2a2: 0x0065  0x0020  0x0052  0x0065  0x0063  0x006f  0x0076  0x0065
0x10b7df2b2: 0x0072  0x0079
(gdb) # Now dump the buffer as words. Most confusing.
(gdb) # It looks like "uAotS-va eeRocevyr"!
(gdb) x/9xw $rsi
0x10b7df292: 0x00750041      0x006f0074      0x0053002d      0x00760061
0x10b7df2a2: 0x00200065      0x00650052      0x006f0063      0x00650076
0x10b7df2b2: 0x00790072
(gdb) # Now dump the buffer as bytes. This is a little less 
(gdb) # confusing, but you still have to remember that it's big 
(gdb) # endian data.
(gdb) x/36xb $rsi
0x10b7df292: 0x41    0x00    0x75    0x00    0x74    0x00    0x6f    0x00
0x10b7df29a: 0x2d    0x00    0x53    0x00    0x61    0x00    0x76    0x00
0x10b7df2a2: 0x65    0x00    0x20    0x00    0x52    0x00    0x65    0x00
0x10b7df2aa: 0x63    0x00    0x6f    0x00    0x76    0x00    0x65    0x00
0x10b7df2b2: 0x72    0x00    0x79    0x00<span></span></pre></td></tr></table></div></section></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION15" title="Controlled Crash"></a><h3 class="jump">Controlled Crash</h3><p>In some cases it's useful to crash your program in a controlled manner. One common way to do this is to call <span class="content_text"><a href="x-man-page://3/abort" class="urlLink" rel="external">abort</a></span>. Another option is to use the <code>__builtin_trap</code> intrinsic function, which generates a machine-specific trap instruction. <span class="content_text"><!--a  -->Listing 6<!--/a--></span> shows how this is done.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE6" title="Listing 6Crashing via __builtin_trap"></a><p class="codesample clear"><strong class="caption_number">Listing 6</strong>&nbsp;&nbsp;Crashing via __builtin_trap</p><div class="codesample clear"><table><tr><td scope="row"><pre>int main(int argc, char **argv) {     __builtin_trap();     return 1; }<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_10" title="Note"></a><p><strong>Note:</strong>&nbsp;The <code>__builtin_trap</code> intrinsic function generates a <code>trap</code> instruction on PowerPC and ARM, and a <code>ud2a</code> instruction on Intel.</p><p></p></aside></div><p>If you run the program in the debugger, you will stop at the line immediately before the <code>__builtin_trap</code> call. Otherwise the program will crash and generate a crash report.</p><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_11" title="Warning"></a><p><strong>Warning:</strong>&nbsp;We recommend that you restrict this technique to debug builds; your release builds should use <code>abort</code>.</p><p></p><div class="clear"></div></aside></div><p>Be mindful that the iOS application lifecycle is under user control, meaning that iOS applications should not just quit. Your release build should only call <code>abort</code> in circumstances where it would have crashed anyway, and the <code>abort</code> call prevents damage to user data or allows you to more easily diagnose the problem.</p></section><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION17" title="Instruments"></a><h2 class="jump">Instruments</h2><p>Instruments is an application for dynamically tracing and profiling code. It runs on Mac OS X and allows you to target programs running on Mac OS X, iOS devices, and the iPhone Simulator.</p><p>While Instruments is primarily focused on <span class="content_text"><!--a  -->performance debugging<!--/a--></span>, you can also use it for debugging errors. For example, the ObjectAlloc instrument can help you track down both over- and under-release bugs.</p><p>One particularly nice feature of Instruments is that it gives you easy access to <span class="content_text"><!--a  -->zombies<!--/a--></span>. See the <span class="content_text"><a href="../../../mac/index.html#DOCUMENTATION/DeveloperTools/Conceptual/InstrumentsUserGuide/Introduction/Introduction.html" class="browserLink" >Instruments User Guide</a></span> for details on this and other Instruments features.</p><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION18" title="CrashReporter"></a><h2 class="jump">CrashReporter</h2><p>CrashReporter is an invaluable debugging facility that logs information about all programs that crash. It is enabled all the time; all you have to do is look at its output.</p><p>CrashReporter is described in detail in <span class="content_text"><a href="../../../mac/navigation/topic_details/resourceType_2.html" class="urlLink" rel="external">Technical Note TN2151, 'Understanding and Analyzing iPhone OS Application Crash Reports'</a></span>. </p><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION19" title="BSD"></a><h2 class="jump">BSD</h2><p>The BSD subsystem implements process, memory, file, and network infrastructure, and thus is critical to all programs on the system. BSD implements a number of neat debugging facilities that you can take advantage of.</p><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION19" title="Memory Allocator"></a><h3 class="jump">Memory Allocator</h3><p>The default memory allocator includes a number of debugging facilities that you can enable via environment variables. These are fully documented in the <span class="content_text"><a href="x-man-page://3/malloc" class="urlLink" rel="external">manual page</a></span>. <span class="content_text"><!--a  -->Table 5<!--/a--></span> lists some of the more useful ones.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE5" title="Table 5Some useful memory allocator environment variables"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 5</strong>&nbsp;&nbsp;Some useful memory allocator environment variables</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Variable
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td  scope="row"><p>
MallocScribble
</p></td><td ><p>
Fill allocated memory with 0xAA and scribble deallocated memory with 0x55
</p></td></tr><tr><td  scope="row"><p>
MallocGuardEdges
</p></td><td ><p>
Add guard pages before and after large allocations
</p></td></tr><tr><td  scope="row"><p>
MallocStackLogging
</p></td><td ><p>
Record backtraces for each memory block to assist memory debugging tools; if the block is allocated and then immediately freed, both entries are removed from the log, which helps reduce the size of the log
</p></td></tr><tr><td  scope="row"><p>
MallocStackLoggingNoCompact
</p></td><td ><p>
Same as MallocStackLogging but keeps all log entries
</p></td></tr></table></div><p>The default memory allocator also logs messages if it detects certain common programming problems. For example, if you free a block of memory twice, or free memory that you never allocated, <code>free</code> may print the message shown in <span class="content_text"><!--a  -->Listing 7<!--/a--></span>. The number inside parentheses is the process ID.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE7" title="Listing 7A common message printed by free"></a><p class="codesample clear"><strong class="caption_number">Listing 7</strong>&nbsp;&nbsp;A common message printed by free</p><div class="codesample clear"><table><tr><td scope="row"><pre>DummyPhone(1839) malloc: *** error for object 0x826600: double free *** set a breakpoint in malloc_error_break to debug<span></span></pre></td></tr></table></div><p>You can debug this sort of problem by running your program within GDB and putting a breakpoint on <code>malloc_error_break</code>. Once you hit the breakpoint, you can use GDB's <code>backtrace</code> command to determine the immediate caller.</p><p>Finally, you can programmatically check the consistency of the heap using the <code>malloc_zone_check</code> routine (from <code>&lt;malloc.h&gt;</code>).</p></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION20" title="Standard C++ Library"></a><h3 class="jump">Standard C++ Library</h3><p>The standard C++ library supports a number of debugging features:</p><ul class="ul"><li class="li"><p>Set the <code>_GLIBCXX_DEBUG</code> compile-time variable to enable debug mode in the standard C++ library.</p><p>This item is not supported in GCC 4.2 or later, and you must not use it in that context.</p></li><li class="li"><p>In versions prior to GCC 4.0, set the <code>GLIBCPP_FORCE_NEW</code> environment variable to 1 to disable memory caching in the standard C++ library. This allows you to debug your C++ allocations with the other <span class="content_text"><!--a  -->memory debugging tools<!--/a--></span>.</p><p>In GCC 4.0 and later this is the default behavior.</p></li></ul></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION21" title="Dynamic Linker (dyld)"></a><h3 class="jump">Dynamic Linker (dyld)</h3><p>The dynamic linker (dyld) supports a number of debugging facilities that you can enable via environment variables. These are fully documented in the <span class="content_text"><a href="x-man-page://1/dyld" class="urlLink" rel="external">manual page</a></span>. <span class="content_text"><!--a  -->Table 6<!--/a--></span> lists some of the more useful variables.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE6" title="Table 6Dynamic linker environment variables"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 6</strong>&nbsp;&nbsp;Dynamic linker environment variables</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Variable
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td  scope="row"><p>
DYLD_IMAGE_SUFFIX
</p></td><td ><p>
Search for libraries with this suffix first
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_LIBRARIES
</p></td><td ><p>
Log library loads
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_LIBRARIES_POST_LAUNCH
</p></td><td ><p>
As above, but only after main has run
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_OPTS [1]
</p></td><td ><p>
Print launch-time command line arguments
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_ENV [1]
</p></td><td ><p>
Print launch-time environment variables
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_APIS [1]
</p></td><td ><p>
Log dyld API calls (for example, dlopen)
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_BINDINGS [1]
</p></td><td ><p>
Log symbol bindings
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_INITIALIZERS [1]
</p></td><td ><p>
Log image initialization calls
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_SEGMENTS [1]
</p></td><td ><p>
Log segment mapping
</p></td></tr><tr><td  scope="row"><p>
DYLD_PRINT_STATISTICS [1]
</p></td><td ><p>
Print launch performance statistics
</p></td></tr></table></div><p><strong>Notes:</strong></p><ol class="ol"><li class="li"><p>On the Mac OS X side these are only available on Mac OS X 10.4 and later. They are, however, available on all versions of iOS.</p></li></ol><p>While these environment variables are implemented on iOS, many of them have limited utility because of the restricted environment on that system.</p></section><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION23" title="Core Services"></a><h2 class="jump">Core Services</h2><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION23" title="Core Foundation"></a><h3 class="jump">Core Foundation</h3><p>The Core Foundation (CF) framework exports the <code>CFShow</code> routine, which prints a description of any CF object to <code>stderr</code>. You can make this call from your own code, however, it's particularly useful when <span class="content_text"><!--a  -->called from GDB<!--/a--></span>. <span class="content_text"><!--a  -->Listing 8<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE8" title="Listing 8Calling CFShow from GDB"></a><p class="codesample clear"><strong class="caption_number">Listing 8</strong>&nbsp;&nbsp;Calling CFShow from GDB</p><div class="codesample clear"><table><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) […]
(gdb) fb CFRunLoopAddSource
Breakpoint 1 at 0x624dd2f195cfa8
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries […]
Breakpoint 1, 0x00007fff8609bfa8 in CFRunLoopAddSource ()
(gdb) # Check that the prologue hasn't changed $rdi.
(gdb) p/a 0x00007fff8609bfa8
$1 = 0x7fff8609bfa8 &lt;CFRunLoopAddSource+24&gt;
(gdb) p/a $pc
$2 = 0x7fff8609bfa8 &lt;CFRunLoopAddSource+24&gt;
(gdb) x/8i $pc-24
0x7fff8609bf90 &lt;CFRunLoopAddSource&gt;: push   %rbp
0x7fff8609bf91 &lt;CFRunLoopAddSource+1&gt;: mov    %rsp,%rbp
0x7fff8609bf94 &lt;CFRunLoopAddSource+4&gt;: mov    %rbx,-0x20(%rbp)
0x7fff8609bf98 &lt;CFRunLoopAddSource+8&gt;: mov    %r12,-0x18(%rbp)
0x7fff8609bf9c &lt;CFRunLoopAddSource+12&gt;: mov    %r13,-0x10(%rbp)
0x7fff8609bfa0 &lt;CFRunLoopAddSource+16&gt;: mov    %r14,-0x8(%rbp)
0x7fff8609bfa4 &lt;CFRunLoopAddSource+20&gt;: sub    $0x40,%rsp
0x7fff8609bfa8 &lt;CFRunLoopAddSource+24&gt;: mov    %rdi,%r12
(gdb) # Nope. Go ahead and CFShow it.
(gdb) call (void)CFShow($rdi)
&lt;CFRunLoop 0x100115540 [0x7fff70b8bf20]&gt;{
    locked = false, 
    wakeup port = 0x1e07, 
    stopped = false,
    current mode = (none),
    common modes = &lt;CFBasicHash 0x1001155a0 [0x7fff70b8bf20]&gt;{
        type = mutable set, 
        count = 1,
        entries =&gt;
            2 : &lt;CFString 0x7fff70b693d0 [0x7fff70b8bf20]&gt;{
                contents = "kCFRunLoopDefaultMode"
            }
    },
    common mode items = (null),
    modes = &lt;CFBasicHash 0x1001155d0 [0x7fff70b8bf20]&gt;{
        type = mutable set, 
        count = 1,
        entries =&gt;
            0 : &lt;CFRunLoopMode 0x100115670 [0x7fff70b8bf20]&gt;{
                name = kCFRunLoopDefaultMode, 
                locked = false, 
                port set = 0x1f03,
                sources = (null),
                observers = (null),
                timers = (null)
        },
    }
}<span></span></pre></td></tr></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_12" title="Important"></a><p><strong>Important:</strong>&nbsp;If you don't see any output from <code>CFShow</code>, it was probably sent to the console. See <span class="content_text"><!--a  -->Seeing Debug Output<!--/a--></span> for information on how to view this output.</p><p></p></aside></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_13" title="Note"></a><p><strong>Note:</strong>&nbsp;In <span class="content_text"><!--a  -->Listing 8<!--/a--></span> the output from <code>CFShow</code> has been reformatted to make it easier to read.</p><p></p></aside></div><p>There are a number of other CF routines that you might find useful to call from GDB, including <code>CFGetRetainCount</code>, <code>CFBundleGetMainBundle</code>, and <code>CFRunLoopGetCurrent</code>.</p><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION23" title="Zombies!"></a><h4 class="jump">Zombies!</h4><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_14" title="Important"></a><p><strong>Important:</strong>&nbsp;If you're programming in Objective-C, you're more likely to be interested in <code>NSZombieEnabled</code>, as described in <span class="content_text"><!--a  -->More Zombies!<!--/a--></span>.</p><p></p></aside></div><p>Core Foundation supports an environment variable called <code>CFZombieLevel</code>. It interprets this variable as an integer containing a set of flag bits. <span class="content_text"><!--a  -->Table 7<!--/a--></span> describes the bits that are currently defined. These can help you track down various CF memory management issues.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE7" title="Table 7Bit definitions for CFZombieLevel environment variable"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 7</strong>&nbsp;&nbsp;Bit definitions for CFZombieLevel environment variable</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Bit
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Action
</p></th></tr><tr><td  scope="row"><p>
0
</p></td><td ><p>
scribble deallocated CF memory
</p></td></tr><tr><td  scope="row"><p>
1
</p></td><td ><p>
when scribbling deallocated CF memory, don't scribble object header (CFRuntimeBase)
</p></td></tr><tr><td  scope="row"><p>
4
</p></td><td ><p>
never free memory used to hold CF objects
</p></td></tr><tr><td  scope="row"><p>
7
</p></td><td ><p>
if set, scribble deallocations using bits 8..15, otherwise use 0xFC
</p></td></tr><tr><td  scope="row"><p>
8..15
</p></td><td ><p>
if bit 7 is set, scribble deallocations using this value
</p></td></tr><tr><td  scope="row"><p>
16
</p></td><td ><p>
scribble allocated CF memory
</p></td></tr><tr><td  scope="row"><p>
23
</p></td><td ><p>
if set, scribble allocations using bits 24..31, otherwise use 0xCF
</p></td></tr><tr><td  scope="row"><p>
24..31
</p></td><td ><p>
if bit 23 is set, scribble allocations using this value
</p></td></tr></table></div></section></section><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION26" title="Application Services"></a><h2 class="jump">Application Services</h2><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION26" title="Core Animation"></a><h3 class="jump">Core Animation</h3><p>The Core Animation instrument lets you measure your application's frame rate and see various types of drawing. See <span class="content_text"><a href="../../../mac/index.html#DOCUMENTATION/DeveloperTools/Conceptual/InstrumentsUserGuide/Introduction/Introduction.html" class="browserLink" >Instruments User Guide</a></span> for details.</p></section><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION28" title="Cocoa and Cocoa Touch"></a><h2 class="jump">Cocoa and Cocoa Touch</h2><p>All Cocoa objects (everything derived from <code>NSObject</code>) support a <code>description</code> method that returns an <code>NSString</code> describing the object. The most convenient way to access this description is via Xcode's Print Description to Console menu command. Alternatively, if you're a command line junkie, you can use GDB's <code>print-object</code> (or <code>po</code> for short) command, as illustrated by <span class="content_text"><!--a  -->Listing 9<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE9" title="Listing 9Using GDB's po command"></a><p class="codesample clear"><strong class="caption_number">Listing 9</strong>&nbsp;&nbsp;Using GDB's po command</p><div class="codesample clear"><table><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) […]
(gdb) fb -[NSCFDictionary copyWithZone:]
Breakpoint 1 at 0x83126e97675259
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries […]
Breakpoint 1, 0x00007fff837aa259 in -[NSCFDictionary copyWithZone:] ()
(gdb) po $rdi
{
    AddExtensionToNewPlainTextFiles = 1;
    AutosaveDelay = 30;
    CheckGrammarWithSpelling = 0;
    CheckSpellingWhileTyping = 1;
    […]
}<span></span></pre></td></tr></table></div><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION28" title="Objective-C"></a><h3 class="jump">Objective-C</h3><p>To break on an Objective-C exception, regardless of how it's thrown, set a symbolic breakpoint on <code>objc_exception_throw</code>. The easiest way to set such a breakpoint is with Xcode's Stop on Objective-C Exceptions menu command.</p><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_15" title="Note"></a><p><strong>Note:</strong>&nbsp;This is better than setting a breakpoint on <code>-[NSException raise]</code> because it will be hit even if the exception is thrown using <code>@throw</code>.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION28" title="Assembly-Level Objective-C Debugging"></a><h4 class="jump">Assembly-Level Objective-C Debugging</h4><p>When debugging Cocoa code at the assembly level, keep in mind the following features of the Objective-C runtime:</p><ul class="ul"><li class="li"><p>The Objective-C compiler adds two implicit parameters to each method, the first of which is a pointer to the object being called (<code>self</code>).</p></li><li class="li"><p>The second implicit parameter is the method selector (<code>_cmd</code>). In Objective-C this is of type <code>SEL</code>; in GDB you can print this as a C string.</p></li><li class="li"><p>The Objective-C runtime dispatches methods via a family of C function. The most commonly seen is <code>objc_msgSend</code>, but some architectures use <code>objc_msgSend_stret</code> for methods which returns structures, and some architectures use <code>objc_msgSend_fpret</code> for methods that return floating point values. There are also equivalent functions for calling <code>super</code> (<code>objc_msgSendSuper</code> and so on).</p></li><li class="li"><p>The first word of any Objective-C object (the <code>isa</code> field) is a pointer to the object's class.</p></li></ul><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_16" title="Note"></a><p><strong>Note:</strong>&nbsp;If you're interested in learning more about Objective-C message dispatch, you should check out <span class="content_text"><a href="http://sealiesoftware.com/blog/archive/2008/09/22/objc_explain_So_you_crashed_in_objc_msgSend.html" class="urlLink" rel="external">this article</a></span>.</p><p></p></aside></div><p><span class="content_text"><!--a  -->Table 8<!--/a--></span> is a summary of how to access <code>self</code> and <code>_cmd</code> from GDB if you've stopped at the first instruction of a method. For more information about this, see <span class="content_text"><!--a  -->Some Assembly Required<!--/a--></span>. </p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE8" title="Table 8Accessing self and _cmd"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 8</strong>&nbsp;&nbsp;Accessing self and _cmd</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Architecture
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
self
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
_cmd
</p></th></tr><tr><td  scope="row"><p>
ARM
</p></td><td ><p>
$r0
</p></td><td ><p>
$r1
</p></td></tr><tr><td  scope="row"><p>
Intel 32-bit
</p></td><td ><p>
*(int*)($esp+4)
</p></td><td ><p>
*(int*)($esp+8)
</p></td></tr></table></div><p><span class="content_text"><!--a  -->Listing 10<!--/a--></span> shows an example of how to use this information from GDB.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_17" title="Important"></a><p><strong>Important:</strong>&nbsp;<span class="content_text"><!--a  -->Listing 10<!--/a--></span> and <span class="content_text"><!--a  -->Listing 11<!--/a--></span> were created on Mac OS X, but the core techniques work the same on iOS; read <span class="content_text"><!--a  -->Some Assembly Required<!--/a--></span> for information on how to translate these techniques to iOS.</p><p></p></aside></div><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE10" title="Listing 10Objective-C runtime 'secrets'"></a><p class="codesample clear"><strong class="caption_number">Listing 10</strong>&nbsp;&nbsp;Objective-C runtime 'secrets'</p><div class="codesample clear"><table><tr><td scope="row"><pre>$ gdb /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) […]
(gdb) # Give the runtime a chance to start up.
(gdb) fb NSApplicationMain
Breakpoint 1 at 0x9374bc69df7307
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries […]
Breakpoint 1, 0x00007fff841a0307 in NSApplicationMain ()
(gdb) # Set a breakpoint on -retain.
(gdb) b *'-[NSObject(NSObject) retain]'
Breakpoint 2 at 0x7fff8608a860
(gdb) c
Continuing.

Breakpoint 2, 0x00007fff8608a860 in -[NSObject(NSObject) retain] ()
(gdb) # Hit the breakpoint; dump the first 4 words of the object
(gdb) x/4xg $rdi
0x1001138f0: 0x00007fff7055e6d8  0x0041002f01a00000
0x100113900: 0x0069006c00700070  0x0069007400610063
(gdb) # Now print the selector
(gdb) x/s $rsi
0x7fff848d73d8: "retain"
(gdb) # Want to 'po' object; must disable the breakpoint first
(gdb) dis
(gdb) po $rdi
/Applications/TextEdit.app
(gdb) # Print the 'isa' pointer, which is a Class object.
(gdb) po 0xa02d9740
NSPathStore2<span></span></pre></td></tr></table></div><p>When debugging without symbols, you can use functions from the Objective-C runtime to assist your debugging efforts. The routines shown in <span class="content_text"><!--a  -->Table 9<!--/a--></span> are particularly useful.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE9" title="Table 9Useful Objective-C runtime functions"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 9</strong>&nbsp;&nbsp;Useful Objective-C runtime functions</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Function
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Summary
</p></th></tr><tr><td  scope="row"><p>
id objc_getClass(const char *name);
</p></td><td ><p>
Get the Objective-C Class object for the given class name
</p></td></tr><tr><td  scope="row"><p>
SEL sel_getUid(const char *str);
</p></td><td ><p>
Get the Objective-C SEL for the given method name
</p></td></tr><tr><td  scope="row"><p>
IMP class_getMethodImplementation(Class cls, SEL name);
</p></td><td ><p>
Get a pointer to the code that implements the given method in a given class
</p></td></tr></table></div><p><span class="content_text"><!--a  -->Listing 11<!--/a--></span> shows an example of debugging the <code>-[DocumentController openUntitledDocumentAndDisplay:error:]</code> method of TextEdit, even though TextEdit does not ship with symbols.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE11" title="Listing 11Using the Objective-C runtime to debug without symbols"></a><p class="codesample clear"><strong class="caption_number">Listing 11</strong>&nbsp;&nbsp;Using the Objective-C runtime to debug without symbols</p><div class="codesample clear"><table><tr><td scope="row"><pre>$ gdb -arch x86_64 /Applications/TextEdit.app
GNU gdb 6.3.50-20050815 (Apple version gdb-1346) […]
(gdb) r
Starting program: /Applications/TextEdit.app/Contents/MacOS/TextEdit 
Reading symbols for shared libraries […]
^C
(gdb) # Try to find the 
(gdb) # -[DocumentController openUntitledDocumentAndDisplay:error:] 
(gdb) # symbol.
(gdb) info func openUntitledDocumentAndDisplay
All functions matching regular expression "openUntitledDocumentAndDisplay":

Non-debugging symbols:
0x00007fff843ac083 -[NSDocumentController openUntitledDocumentAndDisplay:error:]
(gdb) # These are not the droids we're looking for. It turns out that 
(gdb) # TextEdit ships with its symbols stripped, so we'll have to do 
(gdb) # this the hard way.
(gdb) #
(gdb) # Get the Class object for the DocumentController class.
(gdb) set $class=(void *)objc_getClass("DocumentController")
(gdb) # Get the SEL object for the "openUntitledDocumentAndDisplay:error:" method.
(gdb) set $sel=(void *)sel_getUid("openUntitledDocumentAndDisplay:error:")
(gdb) # Get a pointer to the method implementation.
(gdb) call (void*)class_getMethodImplementation($class, $sel)
$1 = (void *) 0x100001966
(gdb) # Confirm that this is sensible. Looks like a method prologue to me.
(gdb) x/4i 0x00009aa5
0x100001966: push   %rbp
0x100001967: mov    %rsp,%rbp
0x10000196a: push   %r12
0x10000196c: push   %rbx
(gdb) # Set a breakpoint on the method.
(gdb) b *0x100001966
Breakpoint 1 at 0x100001966
(gdb) # Resume execution, and then create a new, untitled document.
(gdb) c
Continuing.
[…]
Breakpoint 1, 0x0000000100001966 in ?? ()
(gdb) # We've hit our breakpoint; print the parameters, starting with 
(gdb) # the implicit "self" and "SEL" parameters that are common to all 
(gdb) # methods, followed by the method-specific "display" and 
(gdb) # "error" parameters.
(gdb) po $rdi
&lt;DocumentController: 0x100227a50&gt;
(gdb) x/s $rsi
0x7fff848e4e04: "openUntitledDocumentAndDisplay:error:"
(gdb) p (int)$rdx
$2 = 1
(gdb) x/xg $rcx
0x7fff5fbff108: 0x00000001001238f0<span></span></pre></td></tr></table></div><p>You can learn more about the Objective-C runtime functions and data structures by looking through the headers in <code>/usr/include/objc/</code>.</p><div class="warningbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_18" title="Warning"></a><p><strong>Warning:</strong>&nbsp;The Objective-C runtime lets you uncover many private implementation details of system classes. You must not use any of this information in your final product.</p><p></p><div class="clear"></div></aside></div></section></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION30" title="Foundation"></a><h3 class="jump">Foundation</h3><p>Foundation has a number of debugging facilities that are enabled by environment variables. <span class="content_text"><!--a  -->Table 10<!--/a--></span> highlights the most interesting ones.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-TABLE10" title="Table 10Foundation environment variables"></a><div class="tableholder"><table class="graybox" border = "0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 10</strong>&nbsp;&nbsp;Foundation environment variables</caption><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Name
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Default
</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>
Action
</p></th></tr><tr><td  scope="row"><p>
NSZombieEnabled
</p></td><td ><p>
NO
</p></td><td ><p>
If set to YES, deallocated objects are 'zombified'; this allows you to quickly debug problems where you send a message to an object that has already been freed; see More Zombies! for details
</p></td></tr><tr><td  scope="row"><p>
NSDeallocateZombies
</p></td><td ><p>
NO
</p></td><td ><p>
If set to YES, the memory for 'zombified' objects is actually freed
</p></td></tr><tr><td  scope="row"><p>
NSUnbufferedIO
</p></td><td ><p>
NO
</p></td><td ><p>
If set to YES, Foundation will use unbuffered I/O for stdout (stderr is unbuffered by default)
</p></td></tr></table></div><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_19" title="Important"></a><p><strong>Important:</strong>&nbsp;To enable or disable a Foundation debugging facility, you must set the value of the environment variable to "YES" or "NO", not 1 or 0 as is the case with other system components.</p><p></p></aside></div><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION30" title="Retain Counts"></a><h4 class="jump">Retain Counts</h4><p>You can use <code>-retainCount</code> to get the current retain count of an object. While this can sometimes be a useful debugging aid, be very careful when you interpret the results. <span class="content_text"><!--a  -->Listing 12<!--/a--></span> shows one potential source of confusion.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE12" title="Listing 12Confusing retain count"></a><p class="codesample clear"><strong class="caption_number">Listing 12</strong>&nbsp;&nbsp;Confusing retain count</p><div class="codesample clear"><table><tr><td scope="row"><pre>(gdb) set $s=(void *)[NSClassFromString(@"NSString") string]
(gdb) p (int)[$s retainCount]
$4 = 2147483647
(gdb) p/x 2147483647
$5 = 0x7fffffff
(gdb) # The system maintains a set of singleton strings for commonly 
(gdb) # used values, like the empty string. The retain count for these 
(gdb) # strings is a special value indicating that the object can't be 
(gdb) # released.<span></span></pre></td></tr></table></div><p>Another common source of confusion is the autorelease mechanism. If an object has been autoreleased, its retain count is higher than you might otherwise think, a fact that's compensated for by the autorelease pool releasing it at some point in the future.</p><p>You can determine what objects are in what autorelease pools by calling <code>_CFAutoreleasePoolPrintPools</code> to print the contents of all the autorelease pools on the autorelease pool stack.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE13" title="Listing 13Printing the autorelease pool stack"></a><p class="codesample clear"><strong class="caption_number">Listing 13</strong>&nbsp;&nbsp;Printing the autorelease pool stack</p><div class="codesample clear"><table><tr><td scope="row"><pre>(gdb) call (void)_CFAutoreleasePoolPrintPools()
- -- ---- -------- Autorelease Pools -------- ---- -- -
==== top of stack ================
  0x327890 (NSCFDictionary)
  0x32cf30 (NSCFNumber)
  […]
==== top of pool, 10 objects ================
  0x306160 (__NSArray0)
  0x127020 (NSEvent)
  0x127f60 (NSEvent)
==== top of pool, 3 objects ================
- -- ---- -------- ----------------- -------- ---- -- -<span></span></pre></td></tr></table></div><div class="notebox"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_20" title="Note"></a><p><strong>Note:</strong>&nbsp;<code>_CFAutoreleasePoolPrintPools</code> is only available on iOS 4.0 or later.</p><p></p></aside></div><p>On earlier systems you can use the <code>NSAutoreleasePoolCountForObject</code> function to determine how many times an object has been added to an autorelease pool. For an example, see <span class="content_text"><!--a  -->Listing 14<!--/a--></span>.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE14" title="Listing 14Calling NSAutoreleasePoolCountForObject"></a><p class="codesample clear"><strong class="caption_number">Listing 14</strong>&nbsp;&nbsp;Calling NSAutoreleasePoolCountForObject</p><div class="codesample clear"><table><tr><td scope="row"><pre>(gdb) # d is an NSDictionary created with -[NSDictionary dictionaryWithObjectsAndKeys:].
(gdb) p d
$1 = (NSDictionary *) 0x12d620
(gdb) po d
{
    test = 12345;
}
(gdb) p (int)[d retainCount]
$2 = 1
(gdb) p (int)NSAutoreleasePoolCountForObject(d)
$3 = 1<span></span></pre></td></tr></table></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION31" title="More Zombies!"></a><h4 class="jump">More Zombies!</h4><p>A common type of bug when programming with Cocoa is over-releasing an object. This typically causes your application to crash, but the crash occurs after the last reference count is released (when you try to message the freed object), which is usually quite removed from the original bug. <code>NSZombieEnabled</code> is your best bet for debugging this sort of problems; it will uncover any attempt to interact with a freed object.</p><p>The easiest way to enable zombies is via <span class="content_text"><!--a  -->Instruments<!--/a--></span>. However, you can also enable zombies via an <span class="content_text"><!--a  -->environment variable<!--/a--></span>. <span class="content_text"><!--a  -->Listing 15<!--/a--></span> shows the type of the message you'll see in this case.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE15" title="Listing 15The effect of NSZombie"></a><p class="codesample clear"><strong class="caption_number">Listing 15</strong>&nbsp;&nbsp;The effect of NSZombie</p><div class="codesample clear"><table><tr><td scope="row"><pre>$ NSZombieEnabled=YES build/Debug/DummyMac.app/Contents/MacOS/DummyMac  […] -[AppDelegate testAction:] […] *** -[CFNumber release]: message sent to deallocated instance 0x3737c0 Trace/BPT trap<span></span></pre></td></tr></table></div><p>As shown in <span class="content_text"><!--a  -->Listing 15<!--/a--></span>, the system will execute a breakpoint instruction if it detects a zombie. If you're running under GDB, the program will stop and you can look at the backtrace to see the chain of calls that triggered the zombie detector.</p><p><code>NSZombieEnabled</code> also affects Core Foundation objects as well as Objective-C objects. However, you'll only be notified when you access a zombie Core Foundation object from Objective-C, not when you access it via a CF API.</p></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSUBSECTION32" title="Other Foundation Magic"></a><h4 class="jump">Other Foundation Magic</h4><p>If you're using Key-Value Observing and you want to know who is observing what on a particular object, you can get the observation information for that object and print it using using GDB's <span class="content_text"><!--a  -->print-object command<!--/a--></span>. <span class="content_text"><!--a  -->Listing 16<!--/a--></span> shows an example of this.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE16" title="Listing 16Display key-value observers"></a><p class="codesample clear"><strong class="caption_number">Listing 16</strong>&nbsp;&nbsp;Display key-value observers</p><div class="codesample clear"><table><tr><td scope="row"><pre>(gdb) # self is some Objective-C object.
(gdb) po self
&lt;ZoneInfoManager: 0x48340d0&gt;
(gdb) # Let's see who's observing what key paths.
(gdb) po [self observationInfo]
&lt;NSKeyValueObservationInfo 0x48702d0&gt; (
&lt;NSKeyValueObservance 0x4825490: Observer: 0x48436e0, \
Key path: zones, Options: &lt;New: NO, Old: NO, Prior: NO&gt; \
Context: 0x0, Property: 0x483a820&gt;
)<span></span></pre></td></tr></table></div><p>You can set the <code>NSShowNonLocalizedStrings</code> preference to find strings that should have been localized but weren't. Once enabled, if you request a localized string and the string is not found in a strings file, the system will return the string capitalized and log a message to the console. This is a great way to uncover problems with out-of-date localizations.</p><p>This setting affects <code>NSLocalizedString</code>, all of its variants, and all underlying infrastructure including <code>CFCopyLocalizedString</code>.</p></section></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SUBSECTION34" title="UIKit"></a><h3 class="jump">UIKit</h3><p>UIView implements a useful <code>description</code> method. In addition, it implements a <code>recursiveDescription</code> method that you can call to get a summary of an entire view hierarchy.</p><a name="//apple_ref/doc/uid/DTS40010638-CH1-SOURCECODE17" title="Listing 17UIView's description and recursiveDescription methods"></a><p class="codesample clear"><strong class="caption_number">Listing 17</strong>&nbsp;&nbsp;UIView's description and recursiveDescription methods</p><div class="codesample clear"><table><tr><td scope="row"><pre>-- The following assumes that you're stopped in some view controller method.
(gdb) po [self view]
&lt;UIView: 0x6a107c0; frame = (0 20; 320 460); autoresize = W+H; layer = […]
Current language: auto; currently objective-c
(gdb) po [[self view] recursiveDescription]
&lt;UIView: 0x6a107c0; frame = (0 20; 320 460); autoresize = W+H; layer = […]
   | &lt;UIRoundedRectButton: 0x6a103e0; frame = (124 196; 72 37); opaque = NO; […]
   |    | &lt;UIButtonLabel: 0x6a117b0; frame = (19 8; 34 21); text = 'Test'; […]<span></span></pre></td></tr></table></div></section><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION36" title="Networking"></a><h2 class="jump">Networking</h2><p>The most critical tool for debugging network code is the packet trace. <span class="content_text"><a href="../../../mac/qa/qa1176/index.html" class="urlLink" rel="external">Technical Q&amp;A QA1176, 'Getting a Packet Trace'</a></span> discusses how to get a packet trace on Mac OS X.</p><p>While iOS has no built-in packet tracing facilities, you can often make useful progress by taking your packet trace on a nearby Mac.</p><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION37" title="Power"></a><h2 class="jump">Power</h2><p>The Energy Diagnostics instrument is a great way to understand how your application affects battery life. See <span class="content_text"><a href="../../../mac/index.html#DOCUMENTATION/DeveloperTools/Conceptual/InstrumentsUserGuide/Introduction/Introduction.html" class="browserLink" >Instruments User Guide</a></span> for details.</p><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION38" title="Push Notifications"></a><h2 class="jump">Push Notifications</h2><p><span class="content_text"><a href="../../../mac/navigation/topic_details/resourceType_2.html" class="urlLink" rel="external">Technical Note TN2265, 'Troubleshooting Push Notifications'</a></span> is a comprehensive guide to debugging push notification problems. It also includes a configuration profile (<code>APNsLogging.mobileconfig</code>) that you can <span class="content_text"><!--a  -->install<!--/a--></span> to enable additional debug logging.</p><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><section><a name="//apple_ref/doc/uid/DTS40010638-CH1-SECTION39" title="iPhone Simulator"></a><h2 class="jump">iPhone Simulator</h2><p>iPhone Simulator lets your build and run your iOS code on Mac OS X. Because iPhone Simulator is a Mac OS X application, you can target it with a variety of Mac OS X specific debugging facilities. For example, if you have a problem that can only be solved by DTrace (which is not available on iOS), you can run your application in the simulator and point DTrace at that.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_21" title="Important"></a><p><strong>Important:</strong>&nbsp;The simulator is great for debugging, but <strong>the ultimate arbiter of what will and won't work on iOS is a real device</strong>. It is especially important to keep this in mind when doing performance testing and debugging.</p><p></p></aside></div><p>For more information about Mac OS X debugging facilities, see <span class="content_text"><a href="../../../mac/technotes/tn2124/index.html" class="urlLink" rel="external">Technical Note TN2124, 'Mac OS X Debugging Magic'</a></span>.</p><div class="back_to_top"><a href="_index.html#top">Back to Top</a></div></section><br/><hr/><a name="//apple_ref/doc/uid/DTS40010638-CH1-DontLinkElementID_1" title="Document Revision History"></a><a name="//apple_ref/doc/uid/DTS40010638-RevisionHistory-DontLinkElementID_1" title="Document Revision History"></a><h4>Document Revision History</h4><br/><table class="graybox revision-history" border="0" cellspacing="0" cellpadding="5"><colgroup span="1"><col width="145" /></colgroup><tr><th scope="col" align="left"><strong>Date</strong></th><th scope="col" align="left"><strong>Notes</strong></th></tr><tr><td scope="row">2011-01-22</td><td><p>New document that 
					describes a large collection of iOS debugging hints and tips.</p></td></tr></table><br/>
        <div id="pageNavigationLinks_bottom" class="pageNavigationLinks">
            
        </div><br/>
        <div class="copyright"><br/><hr /><div align="center"><p class="content_text" lang="en" dir="ltr"> Copyright &#x00a9; 2011 Apple Inc. All Rights Reserved. <a href="http://www.apple.com/legal/internet-services/terms/site.html" target="_blank">Terms of Use</a>   |  <a href="http://www.apple.com/privacy/" target="_blank">Privacy Policy</a>  |  Updated: 2011-01-22</p></div></div>

        <!-- /CONTENTS -->
        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>

    <div id="blackout">
    <div id="preload"></div>
</div>
<div id="leave_feedback" class="button" role="button" tabindex="0">Feedback</div>
<div id="modal" aria-hidden="true">
    <div id="closebox" tabindex="0" aria-label="Close feedback form" role="button"></div>
    <div id="sending" class="hidden">
        <h2 tabindex="0">Sending feedback&hellip;</h2>
        <div id="sending_img"></div>
    </div>
    <div id="error" class="hidden">
        <h2 tabindex="0">We&rsquo;re sorry, an error has occurred.</h2>
        <p>Please try submitting your feedback later.</p>
        <div id="error_icon"></div>
    </div>
    <div id="success" class="hidden">
        <h2 tabindex="0">Thank you for providing feedback!</h2>
        <p>Your input helps improve our developer documentation.</p>
        <div id="thank_you_icon"></div>
    </div>
    
    <form id="feedback" action="#" method="post">
        <div class="left-leaf">
            <h2 id="helpful_title" data-asterisk="a1" tabindex="0">How helpful is this document?</h2>     
            <sup id="a1" class="asterisk" aria-hidden="true">*</sup>

            <div id="star_group" role="radiogroup" aria-required="true">
                <label> 
                    <input class="radio" type="radio" name="helped" value="1" /> 
                    Very helpful
                </label>
                <label> 
                    <input class="radio" type="radio" name="helped" value="2" /> 
                    Somewhat helpful
                </label>
                <label>
                    <input class="radio" type="radio" name="helped" value="3" /> 
                    Not helpful
                </label>
            </div>
        </div>
        <div class="right-leaf">
            <h2>How can we improve this document?</h2>
            <div id="improve" class="checkboxes">
                <label>
                    <input type="checkbox" name="typo" /> 
                    Fix typos or links
                </label>
                <label>
                    <input type="checkbox" name="infoIncorrect" /> 
                    Fix incorrect information
                </label>
                <label>
                    <input type="checkbox" name="needs_examples" /> 
                    Add or update code samples
                </label>
                <label>
                    <input type="checkbox" name="needs_art" /> 
                    Add or update illustrations
                </label>
                <label>
                    <input type="checkbox" name="missingInfo" /> 
                    Add information about...
                </label>
            </div>
        </div>

        <textarea id="comment" name="problem" cols="70" rows="8" placeholder="Please tell us more about your experience with this document" data-asterisk="a2" required></textarea>
        <sup id="a2" class="asterisk" aria-hidden="true">*</sup>

        <input id="email" type="email" name="email" placeholder="Email (optional)" size="48">

        <p class="fineprint">
            <em aria-hidden="true"><span>*</span> Required information</em>
        </p> 

        <input id="submit" type="button" value="Send" />

        <section id="legal">
            <p>
                To submit a product bug or enhancement request, please visit the 
                <a href="../../../../bug-reporting/index.html" target="_blank">Bug Reporter</a> 
                page.
            </p>
            <p>
                Please read <a href="http://www.apple.com/legal/policies/ideas.html" target="_blank">Apple's Unsolicited Idea Submission Policy</a> 
                before you send us your feedback.
            </p> 
        </section>
    </form>
</div>

    
    <script charset="utf-8" src="../../Resources/874/JavaScript/lib/prototype.js"></script>
    <script src="../../Resources/874/JavaScript/library.js"></script>
    <script src="../../Resources/874/JavaScript/feedback.js"></script>
</body>
<script type="text/javascript" src="../../../webstats/pagetracker.js"></script>
<script type="text/javascript">
if(typeof PageTracker !== 'undefined') {
  if(window.addEventListener) {
    window.addEventListener("load", function(){PageTracker.logPageLoad()},false);
  } else if(window.attachEvent) {
    window.attachEvent("onload",function(){PageTracker.logPageLoad()});
  }
}
</script>
</html>
